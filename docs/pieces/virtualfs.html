<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<title>Roadmap</title>
	<meta name="tURL" id="tURL" content="../../"/>
	<meta name="description" content="实用脚本/virtualfs - Roadmap">
	<script src="../../js/menu.js"></script>
	<script src='https://giscus.app/client.js' data-repo='JuliaRoadmap/zh' data-repo-id='R_kgDOHQYI2Q' data-category='General' data-category-id='DIC_kwDOHQYI2c4CO2c9' data-mapping='pathname' data-reactions-enabled='1' data-emit-metadata='0' data-input-position='top' data-theme='preferred_color_scheme' data-lang='zh-CN' crossorigin='anonymous' async></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../js/main.js"></script>
	<link id="theme-href" rel="stylesheet" type="text/css" href="../../css/light.css">
	<link rel="stylesheet" type="text/css" href="../../css/general.css">
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css"/>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css"/>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css"/>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
</head>
<body>
	<div id="documenter">
		<nav class="docs-sidebar">
			<a class="docs-logo"><img src="../../assets/images/logo.png" alt="alt" height="96" width="144"></a>
			<div class="docs-package-name">
			<span class="docs-autofit">Roadmap</span>
			</div>
			<ul class="docs-menu"></ul>
		</nav>
		<div class="docs-main">
			<header class="docs-navbar">
				<nav class="breadcrumb">
					<ul class="is-hidden-mobile"><li class="is-active">实用脚本 / virtualfs</li></ul>
					<ul class="is-hidden-tablet"><li class="is-active">实用脚本 / virtualfs</li></ul>
				</nav>
				<div class="docs-right">
					<a class="docs-edit-link" href="https://github.com/JuliaRoadmap/zh/tree/master/docs/pieces/virtualfs.jl" target="_blank">
						<span class="docs-label is-hidden-touch">编辑此页面</span>
					</a>
					<a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="设置"></a>
					<a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a>
				</div>
			</header>
			<article class="content"><pre class="language"><span class="hl-keyword">abstract</span><span class="hl-plain">&nbsp;</span><span class="hl-keyword">type</span><span class="hl-plain">&nbsp;特殊结构&nbsp;</span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">mutable</span><span class="hl-plain">&nbsp;</span><span class="hl-keyword">struct</span><span class="hl-plain">&nbsp;文件<br />	par::</span><span class="hl-type">Union{特殊结构,Nothing}</span><span class="hl-plain"><br />	name::</span><span class="hl-type">String</span><span class="hl-plain"><br />	content::</span><span class="hl-type">String</span><span class="hl-plain"><br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">mutable</span><span class="hl-plain">&nbsp;</span><span class="hl-keyword">struct</span><span class="hl-plain">&nbsp;目录&lt;:特殊结构<br />	par::</span><span class="hl-type">Union{目录,Nothing}</span><span class="hl-plain"><br />	name::</span><span class="hl-type">String</span><span class="hl-plain"><br />	files::</span><span class="hl-type">Dict{String,文件}</span><span class="hl-plain"><br />	dirs::</span><span class="hl-type">Dict{String,目录}</span><span class="hl-plain"><br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-function">目录</span><span class="hl-plain">(par::</span><span class="hl-type">Union{目录,Nothing},name::String</span><span class="hl-plain">)=</span><span class="hl-function">目录</span><span class="hl-plain">(par,name,</span><span class="hl-type">Dict{String,文件}</span><span class="hl-plain">(),</span><span class="hl-type">Dict{String,目录}</span><span class="hl-plain">())<br /></span><span class="hl-keyword">mutable</span><span class="hl-plain">&nbsp;</span><span class="hl-keyword">struct</span><span class="hl-plain">&nbsp;文件系统<br />	root::目录<br />	current::目录<br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">function</span><span class="hl-plain">&nbsp;</span><span class="hl-function">文件系统</span><span class="hl-plain">()<br />	rt=</span><span class="hl-function">目录</span><span class="hl-plain">(</span><span class="hl-special">nothing</span><span class="hl-plain">,</span><span class="hl-string">""</span><span class="hl-plain">)<br />	cu=rt<br />	</span><span class="hl-keyword">return</span><span class="hl-plain">&nbsp;</span><span class="hl-function">文件系统</span><span class="hl-plain">(rt,cu)<br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /><br /></span><span class="hl-keyword">function</span><span class="hl-plain">&nbsp;</span><span class="hl-function">getpath</span><span class="hl-plain">(dir::目录;full::</span><span class="hl-type">Bool</span><span class="hl-plain">=</span><span class="hl-special">false</span><span class="hl-plain">,relative::目录=dir)<br />	</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;full<br />		s=dir.name<br />		</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;dir.par===</span><span class="hl-special">nothing</span><span class="hl-plain"><br />			</span><span class="hl-keyword">return</span><span class="hl-plain">&nbsp;</span><span class="hl-string">"/"</span><span class="hl-plain"><br />		</span><span class="hl-keyword">end</span><span class="hl-plain"><br />		t=dir<br />		</span><span class="hl-keyword">while</span><span class="hl-plain">&nbsp;</span><span class="hl-special">true</span><span class="hl-plain"><br />			t=t.par<br />			</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;t.par===</span><span class="hl-special">nothing</span><span class="hl-plain"><br />				</span><span class="hl-keyword">return</span><span class="hl-plain">&nbsp;</span><span class="hl-string">"/</span><span class="hl-insert">$s</span><span class="hl-string">"</span><span class="hl-plain"><br />			</span><span class="hl-keyword">end</span><span class="hl-plain"><br />			s=</span><span class="hl-string">"</span><span class="hl-insert">$(t.name)</span><span class="hl-string">/</span><span class="hl-insert">$s</span><span class="hl-string">"</span><span class="hl-plain"><br />		</span><span class="hl-keyword">end</span><span class="hl-plain"><br />	</span><span class="hl-keyword">else</span><span class="hl-plain"><br />		s=dir.name<br />		t=dir<br />		</span><span class="hl-keyword">while</span><span class="hl-plain">&nbsp;</span><span class="hl-special">true</span><span class="hl-plain"><br />			t=t.par<br />			</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;t===</span><span class="hl-special">nothing</span><span class="hl-plain"><br />				</span><span class="hl-keyword">return</span><span class="hl-plain">&nbsp;</span><span class="hl-string">"/</span><span class="hl-insert">$s</span><span class="hl-string">"</span><span class="hl-plain"><br />			</span><span class="hl-keyword">elseif</span><span class="hl-plain">&nbsp;t==relative<br />				</span><span class="hl-keyword">return</span><span class="hl-plain">&nbsp;s<br />			</span><span class="hl-keyword">end</span><span class="hl-plain"><br />			s=</span><span class="hl-string">"</span><span class="hl-insert">$(t.name)</span><span class="hl-string">/</span><span class="hl-insert">$s</span><span class="hl-string">"</span><span class="hl-plain"><br />		</span><span class="hl-keyword">end</span><span class="hl-plain"><br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">function</span><span class="hl-plain">&nbsp;</span><span class="hl-function">getdir</span><span class="hl-plain">(dir::目录,path::</span><span class="hl-type">Vector{T}</span><span class="hl-plain">)&nbsp;</span><span class="hl-keyword">where</span><span class="hl-plain">&nbsp;</span><span class="hl-type">T</span><span class="hl-plain">&lt;:</span><span class="hl-type">AbstractString</span><span class="hl-plain"><br />	res=dir<br />	</span><span class="hl-keyword">for</span><span class="hl-plain">&nbsp;i&nbsp;in&nbsp;path<br />		</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;i==</span><span class="hl-string">".."</span><span class="hl-plain"><br />			</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;res!==</span><span class="hl-special">nothing</span><span class="hl-plain"><br />				res=res.par<br />			</span><span class="hl-keyword">end</span><span class="hl-plain"><br />		</span><span class="hl-keyword">elseif</span><span class="hl-plain">&nbsp;i!=</span><span class="hl-string">"."</span><span class="hl-plain"><br />			</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;</span><span class="hl-function">haskey</span><span class="hl-plain">(res.dirs,i)<br />				res=</span><span class="hl-macro">@inbounds</span><span class="hl-plain">&nbsp;res.dirs[i]<br />			</span><span class="hl-keyword">else</span><span class="hl-plain"><br />				</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"未在</span><span class="hl-insert">$(</span><span class="hl-function">getpath</span><span class="hl-insert">(res)</span><span class="hl-string">)找到下一级目录"</span><span class="hl-plain">)<br />			</span><span class="hl-keyword">end</span><span class="hl-plain"><br />		</span><span class="hl-keyword">end</span><span class="hl-plain"><br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br />	</span><span class="hl-keyword">return</span><span class="hl-plain">&nbsp;res<br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">function</span><span class="hl-plain">&nbsp;</span><span class="hl-function">getdir</span><span class="hl-plain">(fs::文件系统,path::</span><span class="hl-type">AbstractString</span><span class="hl-plain">)<br />	v=</span><span class="hl-function">splitpath</span><span class="hl-plain">(path)<br />	</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;</span><span class="hl-function">isempty</span><span class="hl-plain">(v)&nbsp;</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"路径不能为空"</span><span class="hl-plain">)&nbsp;</span><span class="hl-keyword">end</span><span class="hl-plain"><br />	d=fs.current<br />	</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;v[</span><span class="hl-number">1</span><span class="hl-plain">]==</span><span class="hl-string">"/"</span><span class="hl-plain"><br />		d=fs.root<br />		</span><span class="hl-function">popfirst!</span><span class="hl-plain">(v)<br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br />	</span><span class="hl-keyword">return</span><span class="hl-plain">&nbsp;</span><span class="hl-function">getdir</span><span class="hl-plain">(d,v)<br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">function</span><span class="hl-plain">&nbsp;</span><span class="hl-function">getpardir</span><span class="hl-plain">(fs::文件系统,path::</span><span class="hl-type">AbstractString</span><span class="hl-plain">)::</span><span class="hl-type">Pair</span><span class="hl-plain"><br />	v=</span><span class="hl-function">splitpath</span><span class="hl-plain">(path)<br />	</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;</span><span class="hl-function">isempty</span><span class="hl-plain">(v)<br />		</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"路径不能为空"</span><span class="hl-plain">)<br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br />	d=fs.current<br />	</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;v[</span><span class="hl-number">1</span><span class="hl-plain">]==</span><span class="hl-string">"/"</span><span class="hl-plain"><br />		d=fs.root<br />		</span><span class="hl-function">popfirst!</span><span class="hl-plain">(v)<br />		</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;</span><span class="hl-function">isempty</span><span class="hl-plain">(v)<br />			</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"路径不能为空"</span><span class="hl-plain">)<br />		</span><span class="hl-keyword">end</span><span class="hl-plain"><br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br />	last=</span><span class="hl-function">pop!</span><span class="hl-plain">(v)<br />	</span><span class="hl-keyword">return</span><span class="hl-plain">&nbsp;</span><span class="hl-type">Pair</span><span class="hl-plain">(</span><span class="hl-function">getdir</span><span class="hl-plain">(d,v),last)<br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">function</span><span class="hl-plain">&nbsp;</span><span class="hl-function">getfile</span><span class="hl-plain">(fs::文件系统,path::</span><span class="hl-type">AbstractString</span><span class="hl-plain">)<br />	v=</span><span class="hl-function">splitpath</span><span class="hl-plain">(path)<br />	</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;</span><span class="hl-function">isempty</span><span class="hl-plain">(v)<br />		</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"路径不能为空"</span><span class="hl-plain">)<br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br />	fname=</span><span class="hl-function">pop!</span><span class="hl-plain">(v)<br />	d=fs.current<br />	</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;v[</span><span class="hl-number">1</span><span class="hl-plain">]==</span><span class="hl-string">"/"</span><span class="hl-plain"><br />		d=fs.root<br />		</span><span class="hl-function">popfirst!</span><span class="hl-plain">(v)<br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br />	dir=</span><span class="hl-function">getdir</span><span class="hl-plain">(d,v)<br />	</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;</span><span class="hl-function">haskey</span><span class="hl-plain">(dir.files,fname)<br />		</span><span class="hl-keyword">return</span><span class="hl-plain">&nbsp;</span><span class="hl-macro">@inbounds</span><span class="hl-plain">&nbsp;dir.files[fname]<br />	</span><span class="hl-keyword">else</span><span class="hl-plain"><br />		</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"未找到该文件"</span><span class="hl-plain">)<br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /><br /></span><span class="hl-function">_pwd</span><span class="hl-plain">(fs::文件系统)=</span><span class="hl-function">getpath</span><span class="hl-plain">(fs.current;full=</span><span class="hl-special">true</span><span class="hl-plain">)<br /></span><span class="hl-keyword">function</span><span class="hl-plain">&nbsp;</span><span class="hl-function">_ls</span><span class="hl-plain">(fs::文件系统,target::目录=fs.current)<br />	</span><span class="hl-keyword">for</span><span class="hl-plain">&nbsp;i&nbsp;in&nbsp;target.dirs<br />		</span><span class="hl-function">println</span><span class="hl-plain">(i.first,</span><span class="hl-string">"/"</span><span class="hl-plain">)<br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br />	</span><span class="hl-keyword">for</span><span class="hl-plain">&nbsp;i&nbsp;in&nbsp;target.files<br />		</span><span class="hl-function">println</span><span class="hl-plain">(i.first)<br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">function</span><span class="hl-plain">&nbsp;</span><span class="hl-function">_cd</span><span class="hl-plain">(fs::文件系统,path::</span><span class="hl-type">AbstractString</span><span class="hl-plain">)<br />	fs.current=</span><span class="hl-function">getdir</span><span class="hl-plain">(fs,path)<br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">function</span><span class="hl-plain">&nbsp;</span><span class="hl-function">_mkdir</span><span class="hl-plain">(fs::文件系统,path::</span><span class="hl-type">AbstractString</span><span class="hl-plain">;force::</span><span class="hl-type">Bool</span><span class="hl-plain">=</span><span class="hl-special">false</span><span class="hl-plain">)<br />	pair=</span><span class="hl-function">getpardir</span><span class="hl-plain">(fs,path)<br />	dir=pair.first<br />	name=pair.second<br />	</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;force<br />		dir.dirs[name]=</span><span class="hl-function">目录</span><span class="hl-plain">(dir,name)<br />		</span><span class="hl-keyword">return</span><span class="hl-plain"><br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br />	</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;</span><span class="hl-function">haskey</span><span class="hl-plain">(dir.dirs,name)<br />		</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"同名目录已存在"</span><span class="hl-plain">)<br />	</span><span class="hl-keyword">elseif</span><span class="hl-plain">&nbsp;</span><span class="hl-function">haskey</span><span class="hl-plain">(dir.files,name)<br />		</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"同名文件已存在"</span><span class="hl-plain">)<br />	</span><span class="hl-keyword">else</span><span class="hl-plain"><br />		dir.dirs[name]=</span><span class="hl-function">目录</span><span class="hl-plain">(dir,name)<br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">function</span><span class="hl-plain">&nbsp;</span><span class="hl-function">_rmdir</span><span class="hl-plain">(fs::文件系统,path::</span><span class="hl-type">AbstractString</span><span class="hl-plain">)<br />	pair=</span><span class="hl-function">getpardir</span><span class="hl-plain">(fs,path)<br />	dir=pair.first<br />	name=pair.second<br />	q=fs.current<br />	</span><span class="hl-keyword">while</span><span class="hl-plain">&nbsp;q!==</span><span class="hl-special">nothing</span><span class="hl-plain"><br />		</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;q==dir<br />			</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"删除的目录不能包含当前目录"</span><span class="hl-plain">)<br />		</span><span class="hl-keyword">end</span><span class="hl-plain"><br />		q=q.par<br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br />	</span><span class="hl-function">delete!</span><span class="hl-plain">(dir.dirs,name)<br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">function</span><span class="hl-plain">&nbsp;</span><span class="hl-function">_rm</span><span class="hl-plain">(fs::文件系统,path::</span><span class="hl-type">AbstractString</span><span class="hl-plain">)<br />	(dir,name)=</span><span class="hl-function">getpardir</span><span class="hl-plain">(fs,path)<br />	</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;</span><span class="hl-function">haskey</span><span class="hl-plain">(dir.dirs,name)<br />		</span><span class="hl-function">delete!</span><span class="hl-plain">(dir.dirs,name)<br />	</span><span class="hl-keyword">elseif</span><span class="hl-plain">&nbsp;</span><span class="hl-function">haskey</span><span class="hl-plain">(dir.files,name)<br />		</span><span class="hl-function">delete!</span><span class="hl-plain">(dir.files,name)<br />	</span><span class="hl-keyword">else</span><span class="hl-plain"><br />		</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"未找到该资源"</span><span class="hl-plain">)<br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">function</span><span class="hl-plain">&nbsp;</span><span class="hl-function">_cp</span><span class="hl-plain">(fs::文件系统,from::</span><span class="hl-type">AbstractString,to::AbstractString</span><span class="hl-plain">;force::</span><span class="hl-type">Bool</span><span class="hl-plain">=</span><span class="hl-special">false</span><span class="hl-plain">)<br />	(dir,name)=</span><span class="hl-function">getpardir</span><span class="hl-plain">(fs,from)<br />	</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;</span><span class="hl-function">haskey</span><span class="hl-plain">(dir.dirs,name)<br />		dirto=</span><span class="hl-function">getdir</span><span class="hl-plain">(fs,to)<br />		ori=</span><span class="hl-macro">@inbounds</span><span class="hl-plain">(dir.dirs[name])<br />		</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;!force<br />			</span><span class="hl-function">haskey</span><span class="hl-plain">(dirto.dirs,name)&nbsp;?&nbsp;</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"同名目录已存在"</span><span class="hl-plain">)&nbsp;:<br />			</span><span class="hl-function">haskey</span><span class="hl-plain">(dirto.files,name)&nbsp;?&nbsp;</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"同名文件已存在"</span><span class="hl-plain">)&nbsp;:&nbsp;</span><span class="hl-special">nothing</span><span class="hl-plain"><br />		</span><span class="hl-keyword">end</span><span class="hl-plain"><br />		dirto.dirs[name]=</span><span class="hl-function">目录</span><span class="hl-plain">(dirto,name,</span><span class="hl-function">deepcopy</span><span class="hl-plain">(ori.files),</span><span class="hl-function">deepcopy</span><span class="hl-plain">(ori.dirs))<br />	</span><span class="hl-keyword">elseif</span><span class="hl-plain">&nbsp;</span><span class="hl-function">haskey</span><span class="hl-plain">(dir.files,name)<br />		dirto=</span><span class="hl-function">getdir</span><span class="hl-plain">(fs,to)<br />		content=</span><span class="hl-macro">@inbounds</span><span class="hl-plain">(dir.files[name].content)<br />		</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;!force<br />			</span><span class="hl-function">haskey</span><span class="hl-plain">(dirto.dirs,name)&nbsp;?&nbsp;</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"同名目录已存在"</span><span class="hl-plain">)&nbsp;:<br />			</span><span class="hl-function">haskey</span><span class="hl-plain">(dirto.files,name)&nbsp;?&nbsp;</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"同名文件已存在"</span><span class="hl-plain">)&nbsp;:&nbsp;</span><span class="hl-special">nothing</span><span class="hl-plain"><br />		</span><span class="hl-keyword">end</span><span class="hl-plain"><br />		dirto.files[name]=</span><span class="hl-function">文件</span><span class="hl-plain">(dirto,</span><span class="hl-function">deepcopy</span><span class="hl-plain">(name),</span><span class="hl-function">deepcopy</span><span class="hl-plain">(content))<br />	</span><span class="hl-keyword">else</span><span class="hl-plain"><br />		</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"未找到该资源"</span><span class="hl-plain">)<br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">function</span><span class="hl-plain">&nbsp;</span><span class="hl-function">_mv</span><span class="hl-plain">(fs::文件系统,from::</span><span class="hl-type">AbstractString,to::AbstractString</span><span class="hl-plain">;force::</span><span class="hl-type">Bool</span><span class="hl-plain">=</span><span class="hl-special">false</span><span class="hl-plain">)<br />	(dir,name)=</span><span class="hl-function">getpardir</span><span class="hl-plain">(fs,from)<br />	</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;</span><span class="hl-function">haskey</span><span class="hl-plain">(dir.dirs,name)<br />		dirto=</span><span class="hl-function">getdir</span><span class="hl-plain">(fs,to)<br />		ori=</span><span class="hl-macro">@inbounds</span><span class="hl-plain">(dir.dirs[name])<br />		</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;!force<br />			</span><span class="hl-function">haskey</span><span class="hl-plain">(dirto.dirs,name)&nbsp;?&nbsp;</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"同名目录已存在"</span><span class="hl-plain">)&nbsp;:<br />			</span><span class="hl-function">haskey</span><span class="hl-plain">(dirto.files,name)&nbsp;?&nbsp;</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"同名文件已存在"</span><span class="hl-plain">)&nbsp;:&nbsp;</span><span class="hl-special">nothing</span><span class="hl-plain"><br />		</span><span class="hl-keyword">end</span><span class="hl-plain"><br />		dirto.dirs[name]=</span><span class="hl-function">目录</span><span class="hl-plain">(dirto,name,ori.files,ori.dirs)<br />		</span><span class="hl-function">delete!</span><span class="hl-plain">(dir.dirs,name)<br />	</span><span class="hl-keyword">elseif</span><span class="hl-plain">&nbsp;</span><span class="hl-function">haskey</span><span class="hl-plain">(dir.files,name)<br />		dirto=</span><span class="hl-function">getdir</span><span class="hl-plain">(fs,to)<br />		content=</span><span class="hl-macro">@inbounds</span><span class="hl-plain">(dir.files[name].content)<br />		</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;!force<br />			</span><span class="hl-function">haskey</span><span class="hl-plain">(dirto.dirs,name)&nbsp;?&nbsp;</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"同名目录已存在"</span><span class="hl-plain">)&nbsp;:<br />			</span><span class="hl-function">haskey</span><span class="hl-plain">(dirto.files,name)&nbsp;?&nbsp;</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"同名文件已存在"</span><span class="hl-plain">)&nbsp;:&nbsp;</span><span class="hl-special">nothing</span><span class="hl-plain"><br />		</span><span class="hl-keyword">end</span><span class="hl-plain"><br />		dirto.files[name]=</span><span class="hl-function">文件</span><span class="hl-plain">(dirto,name,content)<br />		</span><span class="hl-function">delete!</span><span class="hl-plain">(dir.files,name)<br />	</span><span class="hl-keyword">else</span><span class="hl-plain"><br />		</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"未找到该资源"</span><span class="hl-plain">)<br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">const</span><span class="hl-plain">&nbsp;simdata=</span><span class="hl-type">Dict{String,Tuple{UnitRange,UInt8,Symbol}}</span><span class="hl-plain">(<br />	</span><span class="hl-comment">#&nbsp;"sim"=&gt;(1:1,0x7,"")</span><br /><span class="hl-plain">	</span><span class="hl-string">"pwd"</span><span class="hl-plain">&nbsp;=&gt;&nbsp;(</span><span class="hl-number">0</span><span class="hl-plain">:</span><span class="hl-number">0</span><span class="hl-plain">,</span><span class="hl-number">0x5</span><span class="hl-plain">,:pwd),<br />	</span><span class="hl-string">"chdir"</span><span class="hl-plain">&nbsp;=&gt;&nbsp;(</span><span class="hl-number">0</span><span class="hl-plain">:</span><span class="hl-number">0</span><span class="hl-plain">,</span><span class="hl-number">0x2</span><span class="hl-plain">,:pwd),<br />	</span><span class="hl-string">"ls"</span><span class="hl-plain">&nbsp;=&gt;&nbsp;(</span><span class="hl-number">0</span><span class="hl-plain">:</span><span class="hl-number">1</span><span class="hl-plain">,</span><span class="hl-number">0x1</span><span class="hl-plain">,:ls),<br />	</span><span class="hl-string">"dir"</span><span class="hl-plain">&nbsp;=&gt;&nbsp;(</span><span class="hl-number">0</span><span class="hl-plain">:</span><span class="hl-number">1</span><span class="hl-plain">,</span><span class="hl-number">0x2</span><span class="hl-plain">,:ls),<br />	</span><span class="hl-string">"readdir"</span><span class="hl-plain">&nbsp;=&gt;&nbsp;(</span><span class="hl-number">0</span><span class="hl-plain">:</span><span class="hl-number">1</span><span class="hl-plain">,</span><span class="hl-number">0x4</span><span class="hl-plain">,:ls),<br />	</span><span class="hl-string">"cd"</span><span class="hl-plain">&nbsp;=&gt;&nbsp;(</span><span class="hl-number">1</span><span class="hl-plain">:</span><span class="hl-number">1</span><span class="hl-plain">,</span><span class="hl-number">0x7</span><span class="hl-plain">,:cd),<br />	</span><span class="hl-string">"mkdir"</span><span class="hl-plain">&nbsp;=&gt;&nbsp;(</span><span class="hl-number">1</span><span class="hl-plain">:</span><span class="hl-number">1</span><span class="hl-plain">,</span><span class="hl-number">0x7</span><span class="hl-plain">,:mkdir),<br />	</span><span class="hl-string">"md"</span><span class="hl-plain">&nbsp;=&gt;&nbsp;(</span><span class="hl-number">1</span><span class="hl-plain">:</span><span class="hl-number">1</span><span class="hl-plain">,</span><span class="hl-number">0x2</span><span class="hl-plain">,:mkdir),<br />	</span><span class="hl-string">"rmdir"</span><span class="hl-plain">&nbsp;=&gt;&nbsp;(</span><span class="hl-number">1</span><span class="hl-plain">:</span><span class="hl-number">1</span><span class="hl-plain">,</span><span class="hl-number">0x3</span><span class="hl-plain">,:rmdir),<br />	</span><span class="hl-string">"rm"</span><span class="hl-plain">&nbsp;=&gt;&nbsp;(</span><span class="hl-number">1</span><span class="hl-plain">:</span><span class="hl-number">1</span><span class="hl-plain">,</span><span class="hl-number">0x5</span><span class="hl-plain">,:rm),<br />	</span><span class="hl-string">"del"</span><span class="hl-plain">&nbsp;=&gt;&nbsp;(</span><span class="hl-number">1</span><span class="hl-plain">:</span><span class="hl-number">1</span><span class="hl-plain">,</span><span class="hl-number">0x2</span><span class="hl-plain">,:rm),<br />	</span><span class="hl-string">"cp"</span><span class="hl-plain">&nbsp;=&gt;&nbsp;(</span><span class="hl-number">2</span><span class="hl-plain">:</span><span class="hl-number">2</span><span class="hl-plain">,</span><span class="hl-number">0x5</span><span class="hl-plain">,:cp),<br />	</span><span class="hl-string">"copy"</span><span class="hl-plain">&nbsp;=&gt;&nbsp;(</span><span class="hl-number">2</span><span class="hl-plain">:</span><span class="hl-number">2</span><span class="hl-plain">,</span><span class="hl-number">0x2</span><span class="hl-plain">,:cp),<br />	</span><span class="hl-string">"mv"</span><span class="hl-plain">&nbsp;=&gt;&nbsp;(</span><span class="hl-number">2</span><span class="hl-plain">:</span><span class="hl-number">2</span><span class="hl-plain">,</span><span class="hl-number">0x7</span><span class="hl-plain">,:mv),<br />)<br /></span><span class="hl-keyword">function</span><span class="hl-plain">&nbsp;</span><span class="hl-function">init</span><span class="hl-plain">()<br />	fs=</span><span class="hl-function">文件系统</span><span class="hl-plain">()<br />	</span><span class="hl-function">_mkdir</span><span class="hl-plain">(fs,</span><span class="hl-string">"home"</span><span class="hl-plain">)<br />	</span><span class="hl-function">_cd</span><span class="hl-plain">(fs,</span><span class="hl-string">"home"</span><span class="hl-plain">)<br />	fs.current.files[</span><span class="hl-string">"hello.txt"</span><span class="hl-plain">]=</span><span class="hl-function">文件</span><span class="hl-plain">(fs.current,</span><span class="hl-string">"hello.txt"</span><span class="hl-plain">,</span><span class="hl-string">"你好"</span><span class="hl-plain">)<br />	sim=</span><span class="hl-number">0x0</span><span class="hl-plain"><br />	</span><span class="hl-keyword">while</span><span class="hl-plain">&nbsp;</span><span class="hl-special">true</span><span class="hl-plain"><br />		</span><span class="hl-function">print</span><span class="hl-plain">(</span><span class="hl-string">"vfs&gt;&nbsp;"</span><span class="hl-plain">)<br />		s=</span><span class="hl-function">readline</span><span class="hl-plain">()<br />		</span><span class="hl-keyword">try</span><span class="hl-plain"><br />			v=</span><span class="hl-function">split</span><span class="hl-plain">(s)<br />			</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;</span><span class="hl-function">isempty</span><span class="hl-plain">(v)<br />				</span><span class="hl-keyword">continue</span><span class="hl-plain"><br />			</span><span class="hl-keyword">end</span><span class="hl-plain"><br />			com=</span><span class="hl-string">""</span><span class="hl-plain"><br />			</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;v[</span><span class="hl-number">1</span><span class="hl-plain">]==</span><span class="hl-string">"sim"</span><span class="hl-plain"><br />				sim=v[</span><span class="hl-number">2</span><span class="hl-plain">]==</span><span class="hl-string">"unix"</span><span class="hl-plain">&nbsp;?&nbsp;</span><span class="hl-number">0x0</span><span class="hl-plain">&nbsp;:<br />					v[</span><span class="hl-number">2</span><span class="hl-plain">]==</span><span class="hl-string">"windows"</span><span class="hl-plain">&nbsp;?&nbsp;</span><span class="hl-number">0x1</span><span class="hl-plain">&nbsp;:<br />					v[</span><span class="hl-number">2</span><span class="hl-plain">]==</span><span class="hl-string">"julia"</span><span class="hl-plain">&nbsp;?&nbsp;</span><span class="hl-number">0x2</span><span class="hl-plain">&nbsp;:<br />					</span><span class="hl-function">printstyled</span><span class="hl-plain">(</span><span class="hl-string">"不支持的模拟对象"</span><span class="hl-plain">;color=:light_yellow)<br />				</span><span class="hl-function">println</span><span class="hl-plain">()<br />				</span><span class="hl-keyword">continue</span><span class="hl-plain"><br />			</span><span class="hl-keyword">elseif</span><span class="hl-plain">&nbsp;v[</span><span class="hl-number">1</span><span class="hl-plain">]==</span><span class="hl-string">"quit"</span><span class="hl-plain"><br />				</span><span class="hl-keyword">return</span><span class="hl-plain"><br />			</span><span class="hl-keyword">else</span><span class="hl-plain"><br />				name=</span><span class="hl-type">String</span><span class="hl-plain">(v[</span><span class="hl-number">1</span><span class="hl-plain">])<br />				</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;!</span><span class="hl-function">haskey</span><span class="hl-plain">(simdata,name)<br />					</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"不支持的命令"</span><span class="hl-plain">)<br />				</span><span class="hl-keyword">end</span><span class="hl-plain"><br />				data=</span><span class="hl-macro">@inbounds</span><span class="hl-plain">&nbsp;simdata[name]<br />				vl=</span><span class="hl-function">length</span><span class="hl-plain">(v)-</span><span class="hl-number">1</span><span class="hl-plain"><br />				</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;!</span><span class="hl-function">in</span><span class="hl-plain">(vl,data[</span><span class="hl-number">1</span><span class="hl-plain">])<br />					</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"错误的参数个数"</span><span class="hl-plain">)<br />				</span><span class="hl-keyword">end</span><span class="hl-plain"><br />				</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;data[</span><span class="hl-number">2</span><span class="hl-plain">]&gt;&gt;sim&amp;</span><span class="hl-number">0x1</span><span class="hl-plain">&nbsp;!=&nbsp;</span><span class="hl-number">0x1</span><span class="hl-plain"><br />					</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"该环境不支持该命令"</span><span class="hl-plain">)<br />				</span><span class="hl-keyword">end</span><span class="hl-plain"><br />				com=data[</span><span class="hl-number">3</span><span class="hl-plain">]<br />			</span><span class="hl-keyword">end</span><span class="hl-plain"><br />			com==:pwd&nbsp;?&nbsp;</span><span class="hl-function">println</span><span class="hl-plain">(</span><span class="hl-function">_pwd</span><span class="hl-plain">(fs))&nbsp;:<br />			com==:ls&nbsp;?&nbsp;</span><span class="hl-function">_ls</span><span class="hl-plain">(fs,vl==</span><span class="hl-number">1</span><span class="hl-plain">&nbsp;?&nbsp;</span><span class="hl-function">getdir</span><span class="hl-plain">(fs,v[</span><span class="hl-number">2</span><span class="hl-plain">])&nbsp;:&nbsp;fs.current)&nbsp;:<br />			com==:cd&nbsp;?&nbsp;</span><span class="hl-function">_cd</span><span class="hl-plain">(fs,v[</span><span class="hl-number">2</span><span class="hl-plain">])&nbsp;:<br />			com==:mkdir&nbsp;?&nbsp;</span><span class="hl-function">_mkdir</span><span class="hl-plain">(fs,v[</span><span class="hl-number">2</span><span class="hl-plain">])&nbsp;:<br />			com==:rmdir&nbsp;?&nbsp;</span><span class="hl-function">_rmdir</span><span class="hl-plain">(fs,v[</span><span class="hl-number">2</span><span class="hl-plain">])&nbsp;:<br />			com==:rm&nbsp;?&nbsp;</span><span class="hl-function">_rm</span><span class="hl-plain">(fs,v[</span><span class="hl-number">2</span><span class="hl-plain">])&nbsp;:<br />			com==:cp&nbsp;?&nbsp;</span><span class="hl-function">_cp</span><span class="hl-plain">(fs,v[</span><span class="hl-number">2</span><span class="hl-plain">],v[</span><span class="hl-number">3</span><span class="hl-plain">])&nbsp;:<br />			com==:mv&nbsp;?&nbsp;</span><span class="hl-function">_mv</span><span class="hl-plain">(fs,v[</span><span class="hl-number">2</span><span class="hl-plain">],v[</span><span class="hl-number">3</span><span class="hl-plain">])&nbsp;:<br />			</span><span class="hl-function">throw</span><span class="hl-plain">(</span><span class="hl-string">"程序出错"</span><span class="hl-plain">)<br />		</span><span class="hl-keyword">catch</span><span class="hl-plain">&nbsp;er<br />			</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;</span><span class="hl-function">isa</span><span class="hl-plain">(er,</span><span class="hl-type">String</span><span class="hl-plain">)<br />				</span><span class="hl-function">printstyled</span><span class="hl-plain">(er;color=:light_red)<br />				</span><span class="hl-function">println</span><span class="hl-plain">()<br />			</span><span class="hl-keyword">else</span><span class="hl-plain"><br />				</span><span class="hl-function">throw</span><span class="hl-plain">(er)<br />			</span><span class="hl-keyword">end</span><span class="hl-plain"><br />		</span><span class="hl-keyword">end</span><span class="hl-plain"><br />		</span><span class="hl-function">println</span><span class="hl-plain">()<br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span><span class="hl-function">println</span><span class="hl-plain">(</span><span class="hl-string">"当前只支持命令格式，不支持额外参数</span><span class="hl-escape">\n</span><span class="hl-string">使用</span><span class="hl-escape">\"</span><span class="hl-string">sim&nbsp;目标</span><span class="hl-escape">\"</span><span class="hl-string">切换模拟环境"</span><span class="hl-plain">)<br /></span></pre></article>
			<nav class="docs-footer"><a class="docs-footer-prevpage" href="index.html">« 索引</a></nav>
			<div class='giscus'></div>
		</div>
		<div class="modal" id="documenter-settings">
			<div class="modal-background"></div>
			<div class="modal-card">
				<header class="modal-card-head">
					<p class="modal-card-title">设置</p>
					<button class="delete"></button>
				</header>
				<section class="modal-card-body">
					<p><label class="label">选择主题</label>
						<div class="select">
							<select id="documenter-themepicker">
								<option value="light">light</option><option value="dark">dark</option>
							</select>
						</div>
					</p>
				</section>
				<footer class="modal-card-foot"></footer>
			</div>
		</div>
	</div>
</body>
</html>
