<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<title>Roadmap</title>
	<meta name="tURL" id="tURL" content="../../"/>
	<meta name="description" content="包的使用/TunedModel - Roadmap">
	<script src="../../js/menu.js"></script>
	<script src='https://giscus.app/client.js' data-repo='JuliaRoadmap/zh' data-repo-id='R_kgDOHQYI2Q' data-category='General' data-category-id='DIC_kwDOHQYI2c4CO2c9' data-mapping='pathname' data-reactions-enabled='1' data-emit-metadata='0' data-input-position='top' data-theme='preferred_color_scheme' data-lang='zh-CN' crossorigin='anonymous' async></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../js/main.js"></script>
	<link id="theme-href" rel="stylesheet" type="text/css" href="../../css/light.css">
	<link rel="stylesheet" type="text/css" href="../../css/general.css">
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css"/>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css"/>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css"/>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
</head>
<body>
	<div id="documenter">
		<nav class="docs-sidebar">
			<a class="docs-logo"><img src="../../assets/images/logo.png" alt="alt" height="96" width="144"></a>
			<div class="docs-package-name">
			<span class="docs-autofit">Roadmap</span>
			</div>
			<ul class="docs-menu"></ul>
		</nav>
		<div class="docs-main">
			<header class="docs-navbar">
				<nav class="breadcrumb">
					<ul class="is-hidden-mobile"><li class="is-active">包的使用 / TunedModel</li></ul>
					<ul class="is-hidden-tablet"><li class="is-active">包的使用 / TunedModel</li></ul>
				</nav>
				<div class="docs-right">
					<a class="docs-edit-link" href="https://github.com/JuliaRoadmap/zh/tree/master/docs/packages/data-analysis-tunedmodel.md" target="_blank">
						<span class="docs-label is-hidden-touch">编辑此页面</span>
					</a>
					<a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="设置"></a>
					<a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a>
				</div>
			</header>
			<article class="content"><h1 id='header-TunedModel'>TunedModel<a class='docs-heading-anchor-permalink'></a></h1><p><img src='/assets/images/tunedmodels/1.png' alt='image'></p><h2 id='header-1. 什么是<code>TunedModel</code>'>1. 什么是<code>TunedModel</code><a class='docs-heading-anchor-permalink'></a></h2><p>为了得到更好的模型，我们需要调试模型的参数
还好MLJ为我们提供了<code>TunedModel</code>，我们要做的就是把原来的模型包装起来，进行调试</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">self_tuning_model&nbsp;=&nbsp;</span><span class="hl-type">TunedModel</span><span class="hl-plain">(model&nbsp;=&nbsp;model,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resampling&nbsp;=&nbsp;resampling,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;measure&nbsp;=&nbsp;measure,<br />							&nbsp;&nbsp;&nbsp;rannge&nbsp;=&nbsp;range,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tuning&nbsp;=&nbsp;tuning,<br />							&nbsp;&nbsp;&nbsp;weights&nbsp;=&nbsp;weights)<br />self_tuning_mach&nbsp;=&nbsp;</span><span class="hl-function">machine</span><span class="hl-plain">(self_tuning_model,&nbsp;train_features,&nbsp;train_labels)<br /></span></div></div><br /><h2 id='header-2. 怎么调优模型'>2. 怎么调优模型<a class='docs-heading-anchor-permalink'></a></h2><p>最重要的是参数范围<code>range</code>，参数范围的搜索策略<code>tuning</code>和判断最优结果的指标<code>measure</code></p><h4 id='header-2.1 <code>range</code>'>2.1 <code>range</code><a class='docs-heading-anchor-permalink'></a></h4><p><code>range</code>需要指定<code>model</code>,<code>model</code>的参数<code>:param</code>，范围和取值(scale)
scale 最近我好像弄懂了，具体指取值的做法，比如<code>:linear</code>指均匀取值，<code>:log10</code>指这种情况（瞎猜的），虽然取值时的横轴还是<code>1, 2, 3, 4</code>，但是取值的纵轴却是指数级变化，可以自己画一下看看</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-keyword">using</span><span class="hl-plain">&nbsp;</span><span class="hl-type">Plots</span><span class="hl-plain"><br />r&nbsp;=&nbsp;</span><span class="hl-function">range</span><span class="hl-plain">(</span><span class="hl-type">Int,&nbsp;:junk,&nbsp;lower&nbsp;</span><span class="hl-plain">=&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">,&nbsp;upper&nbsp;=&nbsp;</span><span class="hl-number">100</span><span class="hl-plain">,&nbsp;scale&nbsp;=&nbsp;:log10)<br /></span><span class="hl-function">plot</span><span class="hl-plain">(</span><span class="hl-number">1</span><span class="hl-plain">:</span><span class="hl-number">10</span><span class="hl-plain">,&nbsp;</span><span class="hl-function">iterator</span><span class="hl-plain">(r,&nbsp;</span><span class="hl-number">10</span><span class="hl-plain">))&nbsp;<br /></span></div></div><br /><p><img src='../../assets/images/tunedmodels/2.png' alt='image'>
[数值]单个参数</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">r&nbsp;=&nbsp;</span><span class="hl-function">range</span><span class="hl-plain">(model,&nbsp;:param,&nbsp;lower,&nbsp;upper,&nbsp;scale)&nbsp;<br />range&nbsp;=&nbsp;r,<br /></span></div></div><br /><p>[数值]多个参数</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">r1&nbsp;=&nbsp;</span><span class="hl-function">range</span><span class="hl-plain">(model,&nbsp;:param1,&nbsp;lower,&nbsp;upper,&nbsp;scale)&nbsp;<br />r2&nbsp;=&nbsp;</span><span class="hl-function">range</span><span class="hl-plain">(model,&nbsp;:param2,&nbsp;lower,&nbsp;upper,&nbsp;scale)&nbsp;<br />range&nbsp;=&nbsp;[r1,&nbsp;r2]<br /></span></div></div><br /><p>[特殊]</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">r1&nbsp;=&nbsp;</span><span class="hl-function">range</span><span class="hl-plain">(model,&nbsp;:param,&nbsp;values&nbsp;=&nbsp;[v1,&nbsp;v2,&nbsp;...])<br /></span></div></div><br /><p>补充
如果没有指定<code>scale</code>的话</p><blockquote><p>If scale is unspecified, it is set to :linear, :log, :logminus, or :linear,
according to whether the interval (lower, upper) is bounded, right-unbounded,
left-unbounded, or doubly unbounded, respectively. Note upper=Inf and
lower=-Inf are allowed.</p></blockquote><p>例子
<strong>example1: 对范围进行取值</strong></p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-macro">@load</span><span class="hl-plain">&nbsp;</span><span class="hl-type">LogisticClassifier&nbsp;pkg</span><span class="hl-plain">=</span><span class="hl-type">MLJLinearModels</span><span class="hl-plain"><br />clf&nbsp;=&nbsp;</span><span class="hl-type">LogisticClassifier</span><span class="hl-plain">()<br /></span><span class="hl-comment">#&nbsp;调参的时候记得看这些参数是什么哟</span><br /><span class="hl-plain">r_lambda&nbsp;=&nbsp;</span><span class="hl-function">range</span><span class="hl-plain">(clf,&nbsp;:lambda,&nbsp;lower&nbsp;=&nbsp;-</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;upper&nbsp;=&nbsp;</span><span class="hl-number">5</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;scale&nbsp;=&nbsp;:linear)<br />r_gamma&nbsp;=&nbsp;</span><span class="hl-function">range</span><span class="hl-plain">(clf,&nbsp;&nbsp;:gamma,&nbsp;lower&nbsp;=&nbsp;-</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;upper&nbsp;=&nbsp;</span><span class="hl-number">10</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;scale&nbsp;=&nbsp;:linear)<br /></span></div></div><br /><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-repl-code">julia&gt;&nbsp;</span><span class="hl-function">iterator</span><span class="hl-plain">(r_lambda,&nbsp;</span><span class="hl-number">10</span><span class="hl-plain">)<br /></span><span class="hl-number">10</span><span class="hl-plain">-element&nbsp;</span><span class="hl-type">Array{Float64,1}:</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">01</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">12</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">2</span><span class="hl-plain">.</span><span class="hl-number">23</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">3</span><span class="hl-plain">.</span><span class="hl-number">34</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">4</span><span class="hl-plain">.</span><span class="hl-number">45</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">5</span><span class="hl-plain">.</span><span class="hl-number">56</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">6</span><span class="hl-plain">.</span><span class="hl-number">67</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">7</span><span class="hl-plain">.</span><span class="hl-number">78</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">8</span><span class="hl-plain">.</span><span class="hl-number">89</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-number">10</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain"><br /></span></div></div><br /><p><strong>example2: range范围内参数不够时</strong></p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">r&nbsp;=&nbsp;</span><span class="hl-function">range</span><span class="hl-plain">(</span><span class="hl-type">Int,&nbsp;:junk,&nbsp;lower&nbsp;</span><span class="hl-plain">=&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">,&nbsp;upper&nbsp;=&nbsp;</span><span class="hl-number">10</span><span class="hl-plain">,&nbsp;scale&nbsp;=&nbsp;:linear)<br /></span></div></div><br /><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-repl-code">julia&gt;&nbsp;</span><span class="hl-function">iterator</span><span class="hl-plain">(r,&nbsp;</span><span class="hl-number">100</span><span class="hl-plain">)<br /></span><span class="hl-number">10</span><span class="hl-plain">-element&nbsp;</span><span class="hl-type">Array{Int64,1}:</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">1</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">2</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">3</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">4</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">5</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">6</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">7</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">8</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">9</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-number">10</span><span class="hl-plain"><br /></span></div></div><br /><h4 id='header-2.2 <code>tuning</code>'>2.2 <code>tuning</code><a class='docs-heading-anchor-permalink'></a></h4><p>确定好调参的范围<code>range</code>后，接下来是怎么寻找参数调试的调整策略<code>tuning</code>了
<code>tuning</code>有两种策略，网格搜索和随机搜索</p><h5 id='header-2.2.1 Grid'>2.2.1 Grid<a class='docs-heading-anchor-permalink'></a></h5><blockquote><p>Grid(goal=nothing, resolution=10, rng=Random.GLOBAL_RNG, shuffle=true)</p></blockquote><div class='language language-'><div class='codeblock-header'></div><div class='codeblock-body'>Instantiate a Cartesian grid-based hyperparameter tuning strategy with a<br />specified number of grid points as goal, or using a specified default<br />resolution in each numeric dimension.<br /></div></div><br /><p>可以参考<a href='https://www.cnblogs.com/Vancuicide/p/10530583.html' target='_blank'>这篇文章</a></p><p>网格你们知道吧，我这拿两个范围组成的网格举例
<img src='/assets/images/tunedmodels/3.png' alt='image'></p><ol><li>
<p>goal
<code>goal</code>就是上面那个网格所有的格子数</p>
</li>
</ol><ol><li>
<p>resolution
<code>resolution</code>指每个范围（即每个轴）分成多少块
ps: 如果你提供的范围数据量不够的话，就算你设了再大的<code>resolution</code>，最终<code>resolution</code>还是以这个范围的最大可分的次数为准</p>
</li>
</ol><p><strong>example</strong>
在调整时设置两个范围，<code>TunedModel</code>需要训练的模型总量<code>n</code>与<code>Grid</code>的关系（其实就是上面图片的有多少个横的单元格，有多个竖的单元格，把他们乘起来）**
ps: <code>@doc TunedModel</code> 你会发现<code>n = default_n(tuning, range)</code></p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-macro">@load</span><span class="hl-plain">&nbsp;</span><span class="hl-type">LogisticClassifier&nbsp;pkg</span><span class="hl-plain">=</span><span class="hl-type">MLJLinearModels</span><span class="hl-plain"><br />clf&nbsp;=&nbsp;</span><span class="hl-type">LogisticClassifier</span><span class="hl-plain">()<br /></span><span class="hl-comment">#&nbsp;调参的时候记得看这些参数是什么哟</span><br /><span class="hl-plain">r_lambda&nbsp;=&nbsp;</span><span class="hl-function">range</span><span class="hl-plain">(clf,&nbsp;:lambda,&nbsp;lower&nbsp;=&nbsp;-</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;upper&nbsp;=&nbsp;</span><span class="hl-number">5</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;scale&nbsp;=&nbsp;:linear)<br />r_gamma&nbsp;=&nbsp;</span><span class="hl-function">range</span><span class="hl-plain">(clf,&nbsp;&nbsp;:gamma,&nbsp;lower&nbsp;=&nbsp;-</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;upper&nbsp;=&nbsp;</span><span class="hl-number">10</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;scale&nbsp;=&nbsp;:linear)<br /></span></div></div><br /><p>单个范围调整时的训练模型数</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-keyword">import</span><span class="hl-plain">&nbsp;</span><span class="hl-type">MLJTuning</span><span class="hl-plain">.default_n<br />tuning&nbsp;=&nbsp;</span><span class="hl-type">Grid</span><span class="hl-plain">(resolution&nbsp;=&nbsp;</span><span class="hl-number">10</span><span class="hl-plain">)<br /></span><span class="hl-function">default_n</span><span class="hl-plain">(tuning,&nbsp;r_lambda)&nbsp;==&nbsp;</span><span class="hl-number">10</span><span class="hl-plain">&nbsp;</span><span class="hl-comment">#&nbsp;true</span><br /><span class="hl-function">default_n</span><span class="hl-plain">(tuning,&nbsp;r_gamma)&nbsp;==&nbsp;</span><span class="hl-number">10</span><span class="hl-plain">&nbsp;</span><span class="hl-comment">#&nbsp;true</span><br /><span class="hl-function">default_n</span><span class="hl-plain">(tuning,&nbsp;</span><span class="hl-function">range</span><span class="hl-plain">(</span><span class="hl-type">Int,&nbsp;:junk,&nbsp;lower</span><span class="hl-plain">=</span><span class="hl-number">1</span><span class="hl-plain">,&nbsp;upper=</span><span class="hl-number">5</span><span class="hl-plain">))&nbsp;==&nbsp;</span><span class="hl-number">5</span><span class="hl-plain">&nbsp;</span><span class="hl-comment">#&nbsp;true</span><br /></div></div><br /><p>多个范围调整时的训练模型数</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-function">default_n</span><span class="hl-plain">(tuning,&nbsp;[r_lambda,&nbsp;r_gamma])&nbsp;==&nbsp;</span><span class="hl-number">100</span><span class="hl-plain">&nbsp;</span><span class="hl-comment">#&nbsp;true&nbsp;10&nbsp;x&nbsp;10</span><br /><span class="hl-comment">#&nbsp;范围不够用时</span><br /><span class="hl-plain">r_penalty&nbsp;=&nbsp;</span><span class="hl-function">range</span><span class="hl-plain">(clf,&nbsp;:penalty,&nbsp;values&nbsp;=&nbsp;[:l1,&nbsp;:l2])&nbsp;</span><span class="hl-comment">#&nbsp;iterator最大能取两个</span><br /><span class="hl-function">default_n</span><span class="hl-plain">(tuning,&nbsp;[r_penalty,&nbsp;r_gamma])&nbsp;==&nbsp;</span><span class="hl-number">20</span><span class="hl-plain">&nbsp;</span><span class="hl-comment">#&nbsp;true&nbsp;&nbsp;2&nbsp;x&nbsp;10</span><br /></div></div><br /><h5 id='header-2.2.2 RandomSearch'>2.2.2 RandomSearch<a class='docs-heading-anchor-permalink'></a></h5><blockquote><p>RandomSearch(bounded=Distributions.Uniform,
positive_unbounded=Distributions.Gamma,
other=Distributions.Normal,
rng=Random.GLOBAL_RNG)</p></blockquote><div class='language language-'><div class='codeblock-header'></div><div class='codeblock-body'>Instantiate a random search tuning strategy, for searching over Cartesian<br />hyperparameter domains, with customizable priors in each dimension.<br /><br />TODO 解释Random怎么取值<br /></div></div><br /><h4 id='header-2.3 <code>measure</code>'>2.3 <code>measure</code><a class='docs-heading-anchor-permalink'></a></h4><p><code>measure</code>是为了衡量模型调整参数后的好坏而引入的指标，我们只讨论分类和回归的情况
<a href='https://alan-turing-institute.github.io/MLJ.jl/stable/performance_measures/' target='_blank'>文档在这里</a></p><p>如果我们是指了多么<code>measure</code>，那么只有第一个<code>measure</code>会被作为评估的指标，其他的指标会在模型训练的报告中呈现</p><h4 id='header-2.4 <code>weights</code>'>2.4 <code>weights</code><a class='docs-heading-anchor-permalink'></a></h4><p>也可以指定权重，用数组向量表示</p><h4 id='header-2.5 <code>resampling</code>'>2.5 <code>resampling</code><a class='docs-heading-anchor-permalink'></a></h4><p>内置的重采样策略有三种，
<code>Holdout</code>: 将数据集分为<code>train</code>和<code>test</code>两部分，比例由<code>fraction_train</code>指定
<code>CV</code>: K折交叉验证
<code>StratifiedCV</code>: K折分层交叉验证
三种重采样方法都可以指定<code>shuffle = true</code>来指定，同时可以设定可重复使用的随机数种子
具体用法<a href='https://alan-turing-institute.github.io/MLJ.jl/stable/evaluating_model_performance/' target='_blank'>看这里</a></p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-keyword">using</span><span class="hl-plain">&nbsp;</span><span class="hl-type">StableRNGs</span><span class="hl-plain"><br />rng&nbsp;=&nbsp;</span><span class="hl-type">StableRNG</span><span class="hl-plain">(</span><span class="hl-number">1234</span><span class="hl-plain">)<br /></span></div></div><br /><h2 id='header-3. 怎么得到最优模型'>3. 怎么得到最优模型<a class='docs-heading-anchor-permalink'></a></h2><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-function">fit!</span><span class="hl-plain">(self_tuning_mach)<br />best_model&nbsp;=&nbsp;</span><span class="hl-function">fitted_params</span><span class="hl-plain">(sefl_tuning_mach).best_model<br /></span></div></div><br /><h2 id='header-4. 接下来的工作'>4. 接下来的工作<a class='docs-heading-anchor-permalink'></a></h2><p>如果我们对这个模型有疑问怎么办？
我们可以对这个最优模型进行评估，或是通过<code>learning_curve</code>来观察训练过程
当然，<code>evaluate</code>和<code>learning_curve</code>会单独写文档，因为内容有点多</p><h2 id='header-5. 贴个代码试试'>5. 贴个代码试试<a class='docs-heading-anchor-permalink'></a></h2><h4 id='header-5.1 先试试单个参数调整'>5.1 先试试单个参数调整<a class='docs-heading-anchor-permalink'></a></h4><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-keyword">using</span><span class="hl-plain">&nbsp;</span><span class="hl-type">MLJ</span><span class="hl-plain"><br /></span><span class="hl-type">X&nbsp;</span><span class="hl-plain">=&nbsp;</span><span class="hl-type">MLJ</span><span class="hl-plain">.</span><span class="hl-function">table</span><span class="hl-plain">(</span><span class="hl-function">rand</span><span class="hl-plain">(</span><span class="hl-number">100</span><span class="hl-plain">,</span><span class="hl-number">10</span><span class="hl-plain">))<br />y&nbsp;=&nbsp;</span><span class="hl-number">2</span><span class="hl-type">X</span><span class="hl-plain">.x1&nbsp;-&nbsp;</span><span class="hl-type">X</span><span class="hl-plain">.x2&nbsp;+&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">05</span><span class="hl-plain">&nbsp;*&nbsp;</span><span class="hl-function">rand</span><span class="hl-plain">(</span><span class="hl-number">100</span><span class="hl-plain">)<br />tree_model&nbsp;=&nbsp;</span><span class="hl-macro">@load</span><span class="hl-plain">&nbsp;</span><span class="hl-type">DecisionTreeRegressor</span><span class="hl-plain"><br /></span><span class="hl-comment">#&nbsp;调整单个参数</span><br /><span class="hl-plain">r&nbsp;=&nbsp;</span><span class="hl-function">range</span><span class="hl-plain">(tree_model,&nbsp;:min_purity_increase,&nbsp;lower&nbsp;=&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">01</span><span class="hl-plain">,&nbsp;upper&nbsp;=&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;scale&nbsp;=&nbsp;:linear)<br /><br />self_tuning_tree_model&nbsp;=&nbsp;</span><span class="hl-type">TunedModel</span><span class="hl-plain">(model&nbsp;=&nbsp;tree_model,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resampling&nbsp;=&nbsp;</span><span class="hl-type">CV</span><span class="hl-plain">(nfolds&nbsp;=&nbsp;</span><span class="hl-number">3</span><span class="hl-plain">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tuning&nbsp;=&nbsp;</span><span class="hl-type">Grid</span><span class="hl-plain">(resolution&nbsp;=&nbsp;</span><span class="hl-number">10</span><span class="hl-plain">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;range&nbsp;=&nbsp;r,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;measure&nbsp;=&nbsp;[rms,&nbsp;l1]<br /><br />self_tuning_tree&nbsp;=&nbsp;</span><span class="hl-function">machine</span><span class="hl-plain">(self_tuning_tree_model,&nbsp;</span><span class="hl-type">X,&nbsp;y</span><span class="hl-plain">)<br /></span><span class="hl-function">fit!</span><span class="hl-plain">(self_tuning_tree)<br /><br />best_model&nbsp;=&nbsp;</span><span class="hl-function">fitted_params</span><span class="hl-plain">(self_tuning_tree).best_model<br /></span></div></div><br /><p>这是<code>tree_model</code></p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-repl-code">julia&gt;&nbsp;</span><span class="hl-plain">tree_model<br /></span><span class="hl-type">DecisionTreeRegressor</span><span class="hl-plain">(<br />&nbsp;&nbsp;&nbsp;&nbsp;max_depth&nbsp;=&nbsp;-</span><span class="hl-number">1</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;min_samples_leaf&nbsp;=&nbsp;</span><span class="hl-number">5</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;min_samples_split&nbsp;=&nbsp;</span><span class="hl-number">2</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;min_purity_increase&nbsp;=&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;n_subfeatures&nbsp;=&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;post_prune&nbsp;=&nbsp;</span><span class="hl-special">false</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;merge_purity_threshold&nbsp;=&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">)&nbsp;@</span><span class="hl-number">371</span><span class="hl-plain"><br /></span></div></div><br /><p>这是<code>best_model</code></p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-repl-code">julia&gt;&nbsp;</span><span class="hl-plain">best_model&nbsp;=&nbsp;</span><span class="hl-function">fitted_params</span><span class="hl-plain">(self_tuning_tree).best_model<br /></span><span class="hl-type">DecisionTreeRegressor</span><span class="hl-plain">(<br />&nbsp;&nbsp;&nbsp;&nbsp;max_depth&nbsp;=&nbsp;-</span><span class="hl-number">1</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;min_samples_leaf&nbsp;=&nbsp;</span><span class="hl-number">5</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;min_samples_split&nbsp;=&nbsp;</span><span class="hl-number">2</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;min_purity_increase&nbsp;=&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">01</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;n_subfeatures&nbsp;=&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;post_prune&nbsp;=&nbsp;</span><span class="hl-special">false</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;merge_purity_threshold&nbsp;=&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">)&nbsp;@</span><span class="hl-number">408</span><span class="hl-plain"><br /></span></div></div><br /><p>好吧，好像没什么变化</p><h4 id='header-5.2 再试试多个参数调整，顺便强化一下<code>tree_model</code>，进化成<code>forest</code>'>5.2 再试试多个参数调整，顺便强化一下<code>tree_model</code>，进化成<code>forest</code><a class='docs-heading-anchor-permalink'></a></h4><p>没办法，我没系统学过决策树，不知道里面的参数含义</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">forest_model&nbsp;=&nbsp;</span><span class="hl-type">EnsembleModel</span><span class="hl-plain">(atom&nbsp;=&nbsp;tree_model)<br />r1&nbsp;=&nbsp;</span><span class="hl-function">range</span><span class="hl-plain">(forest_model,&nbsp;:(atom.n_subfeatures),&nbsp;lower&nbsp;=&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">,&nbsp;upper&nbsp;=&nbsp;</span><span class="hl-number">9</span><span class="hl-plain">)<br />r2&nbsp;=&nbsp;</span><span class="hl-function">range</span><span class="hl-plain">(forest_model,&nbsp;:bagging_fraction,&nbsp;lower&nbsp;=&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">4</span><span class="hl-plain">,&nbsp;upper&nbsp;=&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">)<br /><br />self_tuning_forest_model&nbsp;=&nbsp;</span><span class="hl-type">TunedModel</span><span class="hl-plain">(model&nbsp;=&nbsp;forest_model,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tuning&nbsp;=&nbsp;</span><span class="hl-type">Grid</span><span class="hl-plain">(resolution&nbsp;=&nbsp;</span><span class="hl-number">10</span><span class="hl-plain">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resampling&nbsp;=&nbsp;</span><span class="hl-type">CV</span><span class="hl-plain">(nfolds&nbsp;=&nbsp;</span><span class="hl-number">6</span><span class="hl-plain">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;range&nbsp;=&nbsp;[r1,&nbsp;r2],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;measure&nbsp;=&nbsp;rms)<br /><br /></span></div></div><br /><p>原来的<code>forest_model</code></p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-repl-code">julia&gt;&nbsp;</span><span class="hl-plain">forest_model<br /></span><span class="hl-type">DeterministicEnsembleModel</span><span class="hl-plain">(<br />&nbsp;&nbsp;&nbsp;&nbsp;atom&nbsp;=&nbsp;</span><span class="hl-type">DecisionTreeRegressor</span><span class="hl-plain">(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_depth&nbsp;=&nbsp;-</span><span class="hl-number">1</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min_samples_leaf&nbsp;=&nbsp;</span><span class="hl-number">5</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min_samples_split&nbsp;=&nbsp;</span><span class="hl-number">2</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min_purity_increase&nbsp;=&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n_subfeatures&nbsp;=&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_prune&nbsp;=&nbsp;</span><span class="hl-special">false</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;merge_purity_threshold&nbsp;=&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">),<br />&nbsp;&nbsp;&nbsp;&nbsp;atomic_weights&nbsp;=&nbsp;</span><span class="hl-type">Float64</span><span class="hl-plain">[],<br />&nbsp;&nbsp;&nbsp;&nbsp;bagging_fraction&nbsp;=&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">8</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;rng&nbsp;=&nbsp;</span><span class="hl-type">Random</span><span class="hl-plain">.</span><span class="hl-function">_GLOBAL_RNG</span><span class="hl-plain">(),<br />&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;=&nbsp;</span><span class="hl-number">100</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;acceleration&nbsp;=&nbsp;</span><span class="hl-type">CPU1{Nothing}</span><span class="hl-plain">(</span><span class="hl-special">nothing</span><span class="hl-plain">),<br />&nbsp;&nbsp;&nbsp;&nbsp;out_of_bag_measure&nbsp;=&nbsp;</span><span class="hl-type">Any</span><span class="hl-plain">[])&nbsp;@</span><span class="hl-number">723</span><span class="hl-plain"><br /></span></div></div><br /><p>最优模型</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-repl-code">julia&gt;&nbsp;</span><span class="hl-plain">best_model&nbsp;=&nbsp;</span><span class="hl-function">fitted_params</span><span class="hl-plain">(self_tuning_forest).best_model<br /></span><span class="hl-type">DeterministicEnsembleModel</span><span class="hl-plain">(<br />&nbsp;&nbsp;&nbsp;&nbsp;atom&nbsp;=&nbsp;</span><span class="hl-type">DecisionTreeRegressor</span><span class="hl-plain">(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_depth&nbsp;=&nbsp;-</span><span class="hl-number">1</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min_samples_leaf&nbsp;=&nbsp;</span><span class="hl-number">5</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min_samples_split&nbsp;=&nbsp;</span><span class="hl-number">2</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min_purity_increase&nbsp;=&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n_subfeatures&nbsp;=&nbsp;</span><span class="hl-number">9</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;post_prune&nbsp;=&nbsp;</span><span class="hl-special">false</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;merge_purity_threshold&nbsp;=&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">),<br />&nbsp;&nbsp;&nbsp;&nbsp;atomic_weights&nbsp;=&nbsp;</span><span class="hl-type">Float64</span><span class="hl-plain">[],<br />&nbsp;&nbsp;&nbsp;&nbsp;bagging_fraction&nbsp;=&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">8</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;rng&nbsp;=&nbsp;</span><span class="hl-type">Random</span><span class="hl-plain">.</span><span class="hl-function">_GLOBAL_RNG</span><span class="hl-plain">(),<br />&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;=&nbsp;</span><span class="hl-number">100</span><span class="hl-plain">,<br />&nbsp;&nbsp;&nbsp;&nbsp;acceleration&nbsp;=&nbsp;</span><span class="hl-type">CPU1{Nothing}</span><span class="hl-plain">(</span><span class="hl-special">nothing</span><span class="hl-plain">),<br />&nbsp;&nbsp;&nbsp;&nbsp;out_of_bag_measure&nbsp;=&nbsp;</span><span class="hl-type">Any</span><span class="hl-plain">[])&nbsp;@</span><span class="hl-number">027</span><span class="hl-plain"><br /></span></div></div><br /><p>娘的，好像还是没什么变化</p></article>
			<nav class="docs-footer"></nav>
			<div class='giscus'></div>
		</div>
		<div class="modal" id="documenter-settings">
			<div class="modal-background"></div>
			<div class="modal-card">
				<header class="modal-card-head">
					<p class="modal-card-title">设置</p>
					<button class="delete"></button>
				</header>
				<section class="modal-card-body">
					<p><label class="label">选择主题</label>
						<div class="select">
							<select id="documenter-themepicker">
								<option value="light">light</option><option value="dark">dark</option>
							</select>
						</div>
					</p>
				</section>
				<footer class="modal-card-foot"></footer>
			</div>
		</div>
	</div>
</body>
</html>
