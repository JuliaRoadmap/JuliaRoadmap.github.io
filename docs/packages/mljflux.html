<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<title>Roadmap</title>
	<meta name="tURL" id="tURL" content="../../"/>
	<meta name="description" content="包的使用/MLJFlux的使用 - Roadmap">
	<script src="../../js/menu.js"></script>
	<script src='https://giscus.app/client.js' data-repo='JuliaRoadmap/zh' data-repo-id='R_kgDOHQYI2Q' data-category='General' data-category-id='DIC_kwDOHQYI2c4CO2c9' data-mapping='pathname' data-reactions-enabled='1' data-emit-metadata='0' data-input-position='top' data-theme='preferred_color_scheme' data-lang='zh-CN' crossorigin='anonymous' async></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../js/main.js"></script>
	<link id="theme-href" rel="stylesheet" type="text/css" href="../../css/light.css">
	<link rel="stylesheet" type="text/css" href="../../css/general.css">
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css"/>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css"/>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css"/>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
</head>
<body>
	<div id="documenter">
		<nav class="docs-sidebar">
			<a class="docs-logo"><img src="../../assets/images/logo.png" alt="alt" height="96" width="144"></a>
			<div class="docs-package-name">
			<span class="docs-autofit">Roadmap</span>
			</div>
			<ul class="docs-menu"></ul>
		</nav>
		<div class="docs-main">
			<header class="docs-navbar">
				<nav class="breadcrumb">
					<ul class="is-hidden-mobile"><li class="is-active">包的使用 / MLJFlux的使用</li></ul>
					<ul class="is-hidden-tablet"><li class="is-active">包的使用 / MLJFlux的使用</li></ul>
				</nav>
				<div class="docs-right">
					<a class="docs-edit-link" href="https://github.com/JuliaRoadmap/zh/tree/master/docs/packages/mljflux.md" target="_blank">
						<span class="docs-label is-hidden-touch">编辑此页面</span>
					</a>
					<a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="设置"></a>
					<a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a>
				</div>
			</header>
			<article class="content"><h1 id='header-MLJFlux的使用'>MLJFlux的使用<a class='docs-heading-anchor-permalink'></a></h1><p><a href='https://github.com/FluxML/MLJFlux.jl' target='_blank'>MLJFlux</a> 就是 MLJ 框架对 Flux 的封装易于直接使用 Flux</p><p>可以参照这个 <a href='https://playground.tensorflow.org/#activation=relu&regularization=L1&batchSize=10&dataset=circle&regDataset=reg-plane&learningRate=0.03&regularizationRate=0.01&noise=0&networkShape=6,6,6,2&seed=0.28619&showTestData=false&discretize=false&percTrainData=50&x=true&y=true&xTimesY=false&xSquared=false&ySquared=false&cosX=false&sinX=false&cosY=false&sinY=false&collectStats=false&problem=classification&initZero=false&hideText=false%5D%5D' target='_blank'>PlayGround</a> 来学习</p><p><img src='../../assets/images/mljflux/1.png' alt='img'></p><p>其中</p><ul><li><code>features</code> 表示特征</li>
</ul><ul><li><code>hidden layers</code> 表示隐藏层</li>
</ul><ul><li><code>learning rate</code> 设置学习率</li>
</ul><ul><li><code>activation</code> 设置每个神经元的激活函数</li>
</ul><ul><li><code>regularzation</code> 设置正则化方法</li>
</ul><ul><li><code>regularzation rate</code> 设置正则化惩罚力度</li>
</ul><p>但在 MLJ 和 MLJFlux 中，你是找不到任何有关学习率的参数设置的，因为已经有方法可以不设置学习率了，具体参考<a href='https://blog.csdn.net/u012526436/article/details/90486021' target='_blank'>这篇文章</a><br />在 MLJFlux 中，有以下几种模型</p><table style='float:center'><thead><tr><td>模型类型</td><td>预测类型</td><td>scitype(x) &lt;: 啥  scitype(y) &lt;: 啥</td><td></td></tr></thead><tbody><tr><td>NeuralNetworkRegressor</td><td>Deterministic</td><td>Table{Continuous} with n_in columns</td><td>AbstractVector{&lt;:Continuous} n_out = 1</td></tr><tr><td>MultitargetNeuralNetworkRegressor</td><td>Deterministic</td><td>Table{Continuous} with n_in columns</td><td>Table(Continuous) with n_out columns</td></tr><tr><td>NeuralNetworkClassifier</td><td>Probabilistic</td><td>Table(Continuous) with n_in columns</td><td>AbstractVector{&lt;:Finite} with n_out classes</td></tr><tr><td>ImageClassifier</td><td>Probabilistic</td><td>AbstractVector(&lt;:Image{W,H}) with n_in = (W, H)</td><td>AbstractVector{&lt;:Finite} with n_out classes</td></tr></tbody></table><p>它们的参数有</p><ul><li><code>builder</code> : <code>Default = MLJFlux.Linear(σ=Flux.relu) (regressors) or MLJFlux.Short(n_hidden=0, dropout=0.5, σ=Flux.σ) (classifiers)</code></li>
</ul><ul><li><code>optimiser</code> : <code>The optimiser to use for training. Default = Flux.ADAM()</code></li>
</ul><ul><li><code>loss</code> : <code>The loss function used for training. Default = Flux.mse (regressors) and Flux.crossentropy (classifiers)</code></li>
</ul><ul><li><code>n_epochs</code> : <code>Number of epochs to train for. Default = 10</code></li>
</ul><ul><li><code>batch_size</code> : <code>The batch_size for the data. Default = 1</code></li>
</ul><ul><li><code>lambda</code> : <code>The regularization strength. Default = 0. Range = [0, ∞)</code></li>
</ul><ul><li><code>alpha</code>: <code>The L2/L1 mix of regularization. Default = 0. Range = [0, 1]</code></li>
</ul><ul><li><code>rng</code>: <code>The random number generator (RNG) passed to builders, for weight intitialization, for example. Can be any AbstractRNG or the seed (integer) for a MersenneTwister that is reset on every cold restart of model (machine) training. Default = GLOBAL_RNG.</code></li>
</ul><ul><li><code>acceleration</code>: <code>Use CUDALibs() for training on GPU; default is CPU1().</code></li>
</ul><ul><li><code>optimiser_changes_trigger_retraining</code> : <code>True if fitting an associated machine should trigger retraining from scratch whenever the optimiser changes. Default = false</code></li>
</ul><p>来挑几个用的上的参数来说吧，</p><ul><li><code>builder</code> 那个 <code>hidden layer</code> 的表示</li>
</ul><ul><li><code>optimiser</code> 代表优化器，<a href="https://fluxml.ai/Flux.jl/stable/training/optimisers/">具体文档</a></li>
</ul><ul><li><code>loss</code> 表示损失函数</li>
</ul><ul><li><code>n_epochs</code> 表示训练次数</li>
</ul><ul><li><code>batch_size</code> 表示每次拿几个数据一起处理</li>
</ul><ul><li><code>lambda</code> 表示正则化惩罚力度</li>
</ul><ul><li><code>alpha</code> 表示 l2/l1 混合的比例 ？</li>
</ul><h2 id='header-实例'>实例<a class='docs-heading-anchor-permalink'></a></h2><p>对照上图，以分类问题为例，我们需要新建一个 <code>builder</code> 结构来表示隐藏层</p><ul><li>隐藏层有4层</li>
</ul><ul><li>每一层分别有6，6，6，2个神经元</li>
</ul><ul><li>每个神经元的激活函数是 ReLu</li>
</ul><ul><li>正则化方法是l1</li>
</ul><ul><li>正则化惩罚力度是 0.01</li>
</ul><p>由此，创建一个 builder</p><div class='language language-jl'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-keyword">mutable</span><span class="hl-plain">&nbsp;</span><span class="hl-keyword">struct</span><span class="hl-plain">&nbsp;</span><span class="hl-type">NetworkBuilder&nbsp;</span><span class="hl-plain">&lt;:&nbsp;</span><span class="hl-type">MLJFlux</span><span class="hl-plain">.</span><span class="hl-type">Builder</span><span class="hl-plain"><br />	n1::</span><span class="hl-type">Int&nbsp;</span><span class="hl-comment">#&nbsp;第一层神经元数</span><br /><span class="hl-plain">	n2::</span><span class="hl-type">Int&nbsp;</span><span class="hl-comment">#&nbsp;第二层神经元数</span><br /><span class="hl-plain">	n3::</span><span class="hl-type">Int&nbsp;</span><span class="hl-comment">#&nbsp;第三层神经元数</span><br /><span class="hl-plain">	n4::</span><span class="hl-type">Int&nbsp;</span><span class="hl-comment">#&nbsp;第四层神经元数</span><br /><span class="hl-keyword">end</span><span class="hl-plain"><br /></span></div></div><br /><p>再为其重载 <code>MLJFlux.build</code> 方法</p><div class='language language-jl'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-keyword">function</span><span class="hl-plain">&nbsp;</span><span class="hl-type">MLJFlux</span><span class="hl-plain">.</span><span class="hl-function">build</span><span class="hl-plain">(model::</span><span class="hl-type">NetworkBuilder,&nbsp;rng,&nbsp;nin,&nbsp;nout</span><span class="hl-plain">)<br />	init&nbsp;=&nbsp;</span><span class="hl-type">Flux</span><span class="hl-plain">.</span><span class="hl-function">glorot_uniform</span><span class="hl-plain">(rng)<br />	</span><span class="hl-keyword">return</span><span class="hl-plain">&nbsp;</span><span class="hl-type">Chain</span><span class="hl-plain">(<br />		</span><span class="hl-type">Dense</span><span class="hl-plain">(nin,&nbsp;model.n1,&nbsp;relu,&nbsp;init&nbsp;=&nbsp;init),<br />		</span><span class="hl-type">Dense</span><span class="hl-plain">(model.n1,&nbsp;model.n2,&nbsp;relu,&nbsp;init&nbsp;=&nbsp;init),<br />		</span><span class="hl-type">Dense</span><span class="hl-plain">(model.n2,&nbsp;model.n3,&nbsp;relu,&nbsp;init&nbsp;=&nbsp;init),<br />		</span><span class="hl-type">Dense</span><span class="hl-plain">(model.n3,&nbsp;model.n4,&nbsp;relu,&nbsp;init&nbsp;=&nbsp;init),<br />		</span><span class="hl-type">Dense</span><span class="hl-plain">(model.n4,&nbsp;nout,&nbsp;relu,&nbsp;init&nbsp;=&nbsp;init)<br />	)<br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /></span></div></div><br /><p>其中</p><ul><li><code>rng</code> 表示随机数生成器，大概是这个意思</li>
</ul><ul><li><code>nin</code> 表示输入的特征个数</li>
</ul><ul><li><code>nout</code> 表示输出的结果个数</li>
</ul><p>当然，这些不用我们设置，我们只是提供一个方法实现</p><p>接下来就可以定义模型了</p><div class='language language-jl'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">classifier&nbsp;=&nbsp;</span><span class="hl-type">NeuralNetworkClassifier</span><span class="hl-plain">(<br />	builder&nbsp;=&nbsp;</span><span class="hl-type">NetworkBuilder</span><span class="hl-plain">(</span><span class="hl-number">6</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">6</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">6</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">2</span><span class="hl-plain">),<br />	finaliser&nbsp;=&nbsp;softmax,<br />	epochs&nbsp;=&nbsp;</span><span class="hl-number">200</span><span class="hl-plain">,<br />	batch_size&nbsp;=&nbsp;</span><span class="hl-number">10</span><span class="hl-plain">,<br />	lambda&nbsp;=&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">,<br />	alpha&nbsp;=&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">01</span><span class="hl-plain"><br />)<br /></span></div></div><br /><p>他的训练次数是 <code>epochs</code> 而不是 <code>n_epochs</code> ，不知道是不是文档写错了，大家按照这个来就好了<br />定义完模型，就像 MLJ 模型那样调用就好了</p><h2 id='header-使用 MLJFlux 预测波士顿房价'>使用 MLJFlux 预测波士顿房价<a class='docs-heading-anchor-permalink'></a></h2><p><img src='../../assets/images/mljflux/2.png' alt='img'></p><h3 id='header-准备'>准备<a class='docs-heading-anchor-permalink'></a></h3><div class='language language-jl'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-keyword">using</span><span class="hl-plain">&nbsp;</span><span class="hl-type">MLJFlux,&nbsp;MLJ,&nbsp;Statistics,&nbsp;Flux,&nbsp;CSV,&nbsp;StableRNGs,&nbsp;Plots</span><span class="hl-plain"><br /></span><span class="hl-keyword">using</span><span class="hl-plain">&nbsp;</span><span class="hl-type">DataFrames:&nbsp;DataFrame</span><span class="hl-plain"><br /></span><span class="hl-keyword">import</span><span class="hl-plain">&nbsp;</span><span class="hl-type">Random</span><span class="hl-plain">.seed!;<br /></span><span class="hl-function">seed!</span><span class="hl-plain">(</span><span class="hl-number">123</span><span class="hl-plain">)<br />rng&nbsp;=&nbsp;</span><span class="hl-type">StableRNG</span><span class="hl-plain">(</span><span class="hl-number">123</span><span class="hl-plain">)<br /></span><span class="hl-function">plotly</span><span class="hl-plain">()<br />originData&nbsp;=&nbsp;</span><span class="hl-type">CSV</span><span class="hl-plain">.</span><span class="hl-function">read</span><span class="hl-plain">(</span><span class="hl-string">"data/titanic/train.csv"</span><span class="hl-plain">,&nbsp;</span><span class="hl-type">DataFrame</span><span class="hl-plain">)<br /></span></div></div><br /><h3 id='header-数据处理'>数据处理<a class='docs-heading-anchor-permalink'></a></h3><div class='language language-jl'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-function">typeTransformModel!</span><span class="hl-plain">(dataframe::</span><span class="hl-type">DataFrame</span><span class="hl-plain">)&nbsp;=&nbsp;</span><span class="hl-keyword">begin</span><span class="hl-plain"><br />	</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;</span><span class="hl-function">in</span><span class="hl-plain">(</span><span class="hl-string">"Survived"</span><span class="hl-plain">,&nbsp;</span><span class="hl-function">names</span><span class="hl-plain">(dataframe))<br />		</span><span class="hl-function">coerce!</span><span class="hl-plain">(dataframe,&nbsp;:</span><span class="hl-type">Survived&nbsp;</span><span class="hl-plain">=&gt;&nbsp;</span><span class="hl-type">Multiclass</span><span class="hl-plain">)<br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br />	</span><span class="hl-function">coerce!</span><span class="hl-plain">(dataframe,&nbsp;</span><span class="hl-type">Count&nbsp;</span><span class="hl-plain">=&gt;&nbsp;</span><span class="hl-type">Continuous</span><span class="hl-plain">)<br />	</span><span class="hl-function">coerce!</span><span class="hl-plain">(dataframe,&nbsp;</span><span class="hl-type">Textual&nbsp;</span><span class="hl-plain">=&gt;&nbsp;</span><span class="hl-type">Multiclass</span><span class="hl-plain">)<br />	</span><span class="hl-keyword">return</span><span class="hl-plain">&nbsp;dataframe<br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br />	<br />fillMissingModel&nbsp;=&nbsp;</span><span class="hl-type">FillImputer</span><span class="hl-plain">(<br />	features=[:</span><span class="hl-type">Age,&nbsp;:Embarked</span><span class="hl-plain">],<br />	continuous_fill&nbsp;=&nbsp;e&nbsp;-&gt;&nbsp;</span><span class="hl-function">skipmissing</span><span class="hl-plain">(e)&nbsp;|&gt;&nbsp;mode,<br />	finite_fill&nbsp;=&nbsp;e&nbsp;-&gt;&nbsp;</span><span class="hl-function">skipmissing</span><span class="hl-plain">(e)&nbsp;|&gt;&nbsp;mode)<br />	</span><span class="hl-function">newFeatureModel!</span><span class="hl-plain">(dataframe::</span><span class="hl-type">DataFrame</span><span class="hl-plain">)&nbsp;=&nbsp;</span><span class="hl-keyword">begin</span><span class="hl-plain"><br />	</span><span class="hl-comment">#&nbsp;MODULE&nbsp;FeatureA&nbsp;聚集&nbsp;Age,&nbsp;Sex&nbsp;--&gt;&nbsp;12岁以下儿童以及妇女，12岁以上男性</span><br /><span class="hl-plain">	</span><span class="hl-function">feature_filter_a</span><span class="hl-plain">(age,&nbsp;sex)&nbsp;=&nbsp;age&nbsp;&gt;=&nbsp;</span><span class="hl-number">12</span><span class="hl-plain">&nbsp;&amp;&amp;&nbsp;sex&nbsp;==&nbsp;</span><span class="hl-string">"male"</span><span class="hl-plain">&nbsp;?&nbsp;</span><span class="hl-string">"A"</span><span class="hl-plain">&nbsp;:&nbsp;</span><span class="hl-string">"B"</span><span class="hl-plain"><br />	dataframe[!,&nbsp;:</span><span class="hl-type">FeatureA</span><span class="hl-plain">]&nbsp;=&nbsp;</span><span class="hl-function">map</span><span class="hl-plain">(feature_filter_a,&nbsp;dataframe[!,&nbsp;:</span><span class="hl-type">Age</span><span class="hl-plain">],&nbsp;dataframe[!,&nbsp;:</span><span class="hl-type">Sex</span><span class="hl-plain">])<br />	</span><span class="hl-comment">#&nbsp;MODULE&nbsp;FeatureB&nbsp;聚集&nbsp;SibSp,&nbsp;Parch&nbsp;---&gt;&nbsp;家庭人员数量</span><br /><span class="hl-plain">	</span><span class="hl-function">family_size</span><span class="hl-plain">(number)&nbsp;=&nbsp;</span><span class="hl-keyword">begin</span><span class="hl-plain"><br />		</span><span class="hl-keyword">if</span><span class="hl-plain">&nbsp;number&nbsp;==&nbsp;</span><span class="hl-number">1</span><span class="hl-plain"><br />			</span><span class="hl-keyword">return</span><span class="hl-plain">&nbsp;</span><span class="hl-number">0</span><span class="hl-plain"><br />		</span><span class="hl-keyword">elseif</span><span class="hl-plain">&nbsp;number&nbsp;&gt;=&nbsp;</span><span class="hl-number">2</span><span class="hl-plain">&nbsp;&amp;&amp;&nbsp;number&nbsp;&lt;=&nbsp;</span><span class="hl-number">4</span><span class="hl-plain"><br />			</span><span class="hl-keyword">return</span><span class="hl-plain">&nbsp;</span><span class="hl-number">1</span><span class="hl-plain"><br />		</span><span class="hl-keyword">else</span><span class="hl-plain"><br />			</span><span class="hl-keyword">return</span><span class="hl-plain">&nbsp;</span><span class="hl-number">2</span><span class="hl-plain"><br />		</span><span class="hl-keyword">end</span><span class="hl-plain"><br />	</span><span class="hl-keyword">end</span><span class="hl-plain"><br />	dataframe[!,&nbsp;:</span><span class="hl-type">FeatureB</span><span class="hl-plain">]&nbsp;=&nbsp;</span><span class="hl-function">map</span><span class="hl-plain">(family_size,&nbsp;dataframe[!,&nbsp;:</span><span class="hl-type">Parch</span><span class="hl-plain">]&nbsp;.+&nbsp;dataframe[!,&nbsp;:</span><span class="hl-type">SibSp</span><span class="hl-plain">]&nbsp;.+&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">)<br />	</span><span class="hl-comment">#&nbsp;MODULE&nbsp;FeatureC&nbsp;log(Fare&nbsp;+&nbsp;1),&nbsp;encode(Pclass)&nbsp;-&gt;&nbsp;1,&nbsp;2,&nbsp;3&nbsp;&nbsp;</span><br /><span class="hl-plain">	dataframe[!,&nbsp;:</span><span class="hl-type">Fare</span><span class="hl-plain">]&nbsp;=&nbsp;</span><span class="hl-function">map</span><span class="hl-plain">(floor,&nbsp;log.(dataframe[!,&nbsp;:</span><span class="hl-type">Fare</span><span class="hl-plain">]&nbsp;.+&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">))<br />	</span><span class="hl-comment">#&nbsp;TODO&nbsp;don't&nbsp;forget&nbsp;to&nbsp;coerce&nbsp;scitype</span><br /><span class="hl-plain">	</span><span class="hl-function">coerce!</span><span class="hl-plain">(dataframe,&nbsp;:</span><span class="hl-type">FeatureA&nbsp;</span><span class="hl-plain">=&gt;&nbsp;</span><span class="hl-type">Multiclass,&nbsp;:FeatureB&nbsp;</span><span class="hl-plain">=&gt;&nbsp;</span><span class="hl-type">Continuous</span><span class="hl-plain">)<br />	</span><span class="hl-keyword">return</span><span class="hl-plain">&nbsp;dataframe<br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br /><br />encodeModel&nbsp;=&nbsp;</span><span class="hl-type">OneHotEncoder</span><span class="hl-plain">(features=[:</span><span class="hl-type">Embarked,&nbsp;:FeatureA</span><span class="hl-plain">])<br />dropUnusedModel&nbsp;=&nbsp;</span><span class="hl-type">FeatureSelector</span><span class="hl-plain">(features&nbsp;=&nbsp;[:</span><span class="hl-type">Age,&nbsp;:Sex,&nbsp;:SibSp,&nbsp;:Parch,&nbsp;:Cabin,&nbsp;:PassengerId,&nbsp;:Name,&nbsp;:Ticket</span><span class="hl-plain">],&nbsp;ignore=</span><span class="hl-special">true</span><span class="hl-plain">)<br /><br />transformModel&nbsp;=&nbsp;(<br />	typeTransformModel!,<br />	fillMissingModel,<br />	newFeatureModel!,<br />	encodeModel,<br />	dropUnusedModel<br />)<br />transformMachine&nbsp;=&nbsp;</span><span class="hl-function">machine</span><span class="hl-plain">(transformModel,&nbsp;originData)<br /><br /></span><span class="hl-function">fit!</span><span class="hl-plain">(transformMachine)<br />outputData&nbsp;=&nbsp;</span><span class="hl-type">MLJ</span><span class="hl-plain">.</span><span class="hl-function">transform</span><span class="hl-plain">(transformMachine,&nbsp;originData)<br />originSample&nbsp;=&nbsp;</span><span class="hl-type">CSV</span><span class="hl-plain">.</span><span class="hl-function">read</span><span class="hl-plain">(</span><span class="hl-string">"data/titanic/test.csv"</span><span class="hl-plain">,&nbsp;</span><span class="hl-type">DataFrame</span><span class="hl-plain">)<br /><br /></span><span class="hl-comment">#&nbsp;generic&nbsp;typeTransformModel,&nbsp;ignore</span><br /><span class="hl-plain">fillMissingModel&nbsp;=&nbsp;</span><span class="hl-type">FillImputer</span><span class="hl-plain">(features=[:</span><span class="hl-type">Age,&nbsp;:Fare</span><span class="hl-plain">],&nbsp;continuous_fill&nbsp;=&nbsp;e&nbsp;-&gt;&nbsp;</span><span class="hl-function">skipmissing</span><span class="hl-plain">(e)&nbsp;|&gt;&nbsp;mode)<br /><br /></span><span class="hl-comment">#&nbsp;generic&nbsp;new&nbsp;feature&nbsp;generate</span><br /><span class="hl-comment">#&nbsp;generic&nbsp;encode&nbsp;model</span><br /><span class="hl-comment">#&nbsp;generic&nbsp;drop&nbsp;unused</span><br /><span class="hl-plain">transformSampleModel&nbsp;=&nbsp;</span><span class="hl-type">Pipeline</span><span class="hl-plain">(<br />	typeTransformModel!,<br />	fillMissingModel,<br />	newFeatureModel!,<br />	encodeModel,<br />	dropUnusedModel<br />)<br /><br />transformSampleMachine&nbsp;=&nbsp;</span><span class="hl-function">machine</span><span class="hl-plain">(transformSampleModel,&nbsp;originSample)<br /></span><span class="hl-function">fit!</span><span class="hl-plain">(transformSampleMachine)<br /><br />outputSample&nbsp;=&nbsp;</span><span class="hl-type">MLJ</span><span class="hl-plain">.</span><span class="hl-function">transform</span><span class="hl-plain">(transformSampleMachine,&nbsp;originSample)<br /><br /></span><span class="hl-type">Y,&nbsp;X&nbsp;</span><span class="hl-plain">=&nbsp;</span><span class="hl-function">unpack</span><span class="hl-plain">(outputData,&nbsp;colname&nbsp;-&gt;&nbsp;colname&nbsp;==&nbsp;:</span><span class="hl-type">Survived,&nbsp;colname&nbsp;</span><span class="hl-plain">-&gt;&nbsp;</span><span class="hl-special">true</span><span class="hl-plain">)<br /></span></div></div><br /><h3 id='header-模型训练'>模型训练<a class='docs-heading-anchor-permalink'></a></h3><div class='language language-jl'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">rng&nbsp;=&nbsp;</span><span class="hl-type">StableRNG</span><span class="hl-plain">(</span><span class="hl-number">1234</span><span class="hl-plain">)<br />trainRow,&nbsp;testRow&nbsp;=&nbsp;</span><span class="hl-function">partition</span><span class="hl-plain">(</span><span class="hl-function">eachindex</span><span class="hl-plain">(</span><span class="hl-type">Y</span><span class="hl-plain">),&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">7</span><span class="hl-plain">,&nbsp;rng=rng)<br /><br /></span><span class="hl-keyword">mutable</span><span class="hl-plain">&nbsp;</span><span class="hl-keyword">struct</span><span class="hl-plain">&nbsp;</span><span class="hl-type">NetworkBuilder&nbsp;</span><span class="hl-plain">&lt;:&nbsp;</span><span class="hl-type">MLJFlux</span><span class="hl-plain">.</span><span class="hl-type">Builder</span><span class="hl-plain"><br />	n1::</span><span class="hl-type">Int</span><span class="hl-plain"><br />	n2::</span><span class="hl-type">Int</span><span class="hl-plain"><br />	n3::</span><span class="hl-type">Int</span><span class="hl-plain"><br />	n4::</span><span class="hl-type">Int</span><span class="hl-plain"><br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br />	<br /></span><span class="hl-keyword">function</span><span class="hl-plain">&nbsp;</span><span class="hl-type">MLJFlux</span><span class="hl-plain">.</span><span class="hl-function">build</span><span class="hl-plain">(model::</span><span class="hl-type">NetworkBuilder,&nbsp;rng,&nbsp;nin,&nbsp;nout</span><span class="hl-plain">)<br />	init&nbsp;=&nbsp;</span><span class="hl-type">Flux</span><span class="hl-plain">.</span><span class="hl-function">glorot_uniform</span><span class="hl-plain">(rng)<br />	</span><span class="hl-keyword">return</span><span class="hl-plain">&nbsp;</span><span class="hl-type">Chain</span><span class="hl-plain">(<br />		</span><span class="hl-type">Dense</span><span class="hl-plain">(nin,&nbsp;model.n1,&nbsp;relu,&nbsp;init&nbsp;=&nbsp;init),<br />		</span><span class="hl-type">Dense</span><span class="hl-plain">(model.n1,&nbsp;model.n2,&nbsp;relu,&nbsp;init&nbsp;=&nbsp;init),<br />		</span><span class="hl-type">Dense</span><span class="hl-plain">(model.n2,&nbsp;model.n3,&nbsp;relu,&nbsp;init&nbsp;=&nbsp;init),<br />		</span><span class="hl-type">Dense</span><span class="hl-plain">(model.n3,&nbsp;model.n4,&nbsp;relu,&nbsp;init&nbsp;=&nbsp;init),<br />		</span><span class="hl-type">Dense</span><span class="hl-plain">(model.n4,&nbsp;nout,&nbsp;relu,&nbsp;init&nbsp;=&nbsp;init)<br />	)<br /></span><span class="hl-keyword">end</span><span class="hl-plain"><br />	<br />classifier&nbsp;=&nbsp;</span><span class="hl-type">NeuralNetworkClassifier</span><span class="hl-plain">(<br />	builder&nbsp;=&nbsp;</span><span class="hl-type">NetworkBuilder</span><span class="hl-plain">(</span><span class="hl-number">10</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">6</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">6</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">6</span><span class="hl-plain">),<br />	finaliser&nbsp;=&nbsp;softmax,<br />	epochs&nbsp;=&nbsp;</span><span class="hl-number">200</span><span class="hl-plain">,<br />	batch_size&nbsp;=&nbsp;</span><span class="hl-number">10</span><span class="hl-plain">,<br />	lambda&nbsp;=&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">01</span><span class="hl-plain">,<br />	alpha&nbsp;=&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">4</span><span class="hl-plain"><br />)<br /><br />mach&nbsp;=&nbsp;</span><span class="hl-function">machine</span><span class="hl-plain">(classifier,&nbsp;</span><span class="hl-type">X,&nbsp;Y</span><span class="hl-plain">)<br /></span><span class="hl-function">fit!</span><span class="hl-plain">(mach,&nbsp;rows&nbsp;=&nbsp;trainRow)<br /><br />measure&nbsp;=&nbsp;</span><span class="hl-function">evaluate!</span><span class="hl-plain">(mach,<br />	resampling&nbsp;=&nbsp;</span><span class="hl-type">CV</span><span class="hl-plain">(nfolds&nbsp;=&nbsp;</span><span class="hl-number">6</span><span class="hl-plain">,&nbsp;rng&nbsp;=&nbsp;rng),<br />	measure&nbsp;=&nbsp;cross_entropy,<br />	rows&nbsp;=&nbsp;testRow<br />)<br /></span></div></div><br /><h3 id='header-导出结果'>导出结果<a class='docs-heading-anchor-permalink'></a></h3><div class='language language-jl'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">outputPredict&nbsp;=&nbsp;mode.(</span><span class="hl-function">predict</span><span class="hl-plain">(mach,&nbsp;outputSample))&nbsp;|&gt;&nbsp;nums&nbsp;-&gt;&nbsp;</span><span class="hl-function">convert</span><span class="hl-plain">(</span><span class="hl-type">Vector{Int},&nbsp;nums</span><span class="hl-plain">)<br />output_frame&nbsp;=&nbsp;</span><span class="hl-type">DataFrame</span><span class="hl-plain">()<br />output_frame[!,&nbsp;:</span><span class="hl-type">PassengerId</span><span class="hl-plain">]&nbsp;=&nbsp;</span><span class="hl-function">convert</span><span class="hl-plain">(</span><span class="hl-type">Vector{Int},&nbsp;originSample</span><span class="hl-plain">[!,&nbsp;:</span><span class="hl-type">PassengerId</span><span class="hl-plain">])<br />output_frame[!,&nbsp;:</span><span class="hl-type">Survived</span><span class="hl-plain">]&nbsp;=&nbsp;outputPredict<br /></span><span class="hl-type">CSV</span><span class="hl-plain">.</span><span class="hl-function">write</span><span class="hl-plain">(</span><span class="hl-string">"data/titanic/predict.csv"</span><span class="hl-plain">,&nbsp;output_frame)<br /></span></div></div><br /></article>
			<nav class="docs-footer"></nav>
			<div class='giscus'></div>
		</div>
		<div class="modal" id="documenter-settings">
			<div class="modal-background"></div>
			<div class="modal-card">
				<header class="modal-card-head">
					<p class="modal-card-title">设置</p>
					<button class="delete"></button>
				</header>
				<section class="modal-card-body">
					<p><label class="label">选择主题</label>
						<div class="select">
							<select id="documenter-themepicker">
								<option value="light">light</option><option value="dark">dark</option>
							</select>
						</div>
					</p>
				</section>
				<footer class="modal-card-foot"></footer>
			</div>
		</div>
	</div>
</body>
</html>
