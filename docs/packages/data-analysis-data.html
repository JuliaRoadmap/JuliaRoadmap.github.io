<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<title>Roadmap</title>
	<meta name="tURL" id="tURL" content="../../"/>
	<meta name="description" content="包的使用/数据处理 - Roadmap">
	<script src="../../js/menu.js"></script>
	<script src='https://giscus.app/client.js' data-repo='JuliaRoadmap/zh' data-repo-id='R_kgDOHQYI2Q' data-category='General' data-category-id='DIC_kwDOHQYI2c4CO2c9' data-mapping='pathname' data-reactions-enabled='1' data-emit-metadata='0' data-input-position='top' data-theme='preferred_color_scheme' data-lang='zh-CN' crossorigin='anonymous' async></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../js/main.js"></script>
	<link id="theme-href" rel="stylesheet" type="text/css" href="../../css/light.css">
	<link rel="stylesheet" type="text/css" href="../../css/general.css">
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css"/>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css"/>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css"/>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
</head>
<body>
	<div id="documenter">
		<nav class="docs-sidebar">
			<a class="docs-logo"><img src="../../assets/images/logo.png" alt="alt" height="96" width="144"></a>
			<div class="docs-package-name">
			<span class="docs-autofit">Roadmap</span>
			</div>
			<ul class="docs-menu"></ul>
		</nav>
		<div class="docs-main">
			<header class="docs-navbar">
				<nav class="breadcrumb">
					<ul class="is-hidden-mobile"><li class="is-active">包的使用 / 数据处理</li></ul>
					<ul class="is-hidden-tablet"><li class="is-active">包的使用 / 数据处理</li></ul>
				</nav>
				<div class="docs-right">
					<a class="docs-edit-link" href="https://github.com/JuliaRoadmap/zh/tree/master/docs/packages/data-analysis-data.md" target="_blank">
						<span class="docs-label is-hidden-touch">编辑此页面</span>
					</a>
					<a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="设置"></a>
					<a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a>
				</div>
			</header>
			<article class="content"><h1 id='header-数据处理'>数据处理<a class='docs-heading-anchor-permalink'></a></h1><p><img src='/assets/images/data/1.png' alt='image'></p><h2 id='header-0. [非常重要] 类型扩展'>0. [非常重要] 类型扩展<a class='docs-heading-anchor-permalink'></a></h2><p><img src='/assets/images/data/2.png' alt='image'>
我们先准备下数据，以波士顿房价为例，不过我们不用<strong>MLJ</strong>的<code>@load_boston</code>了，因为我们有许多工作需要<code>DataFrame</code>来完成</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-keyword">using</span><span class="hl-plain">&nbsp;</span><span class="hl-type">MLJ</span><span class="hl-plain"><br /></span><span class="hl-keyword">using</span><span class="hl-plain">&nbsp;</span><span class="hl-type">TableView&nbsp;</span><span class="hl-comment">#&nbsp;for&nbsp;showtable</span><br /><span class="hl-plain"><br /></span><span class="hl-keyword">using</span><span class="hl-plain">&nbsp;</span><span class="hl-type">RDatasets</span><span class="hl-plain"><br />boston&nbsp;=&nbsp;</span><span class="hl-function">dataset</span><span class="hl-plain">(</span><span class="hl-string">"MASS"</span><span class="hl-plain">,&nbsp;</span><span class="hl-string">"Boston"</span><span class="hl-plain">);<br />y,&nbsp;</span><span class="hl-type">X&nbsp;</span><span class="hl-plain">=&nbsp;</span><span class="hl-function">unpack</span><span class="hl-plain">(boston,&nbsp;col&nbsp;-&gt;&nbsp;col&nbsp;==&nbsp;:</span><span class="hl-type">MedV,&nbsp;col&nbsp;</span><span class="hl-plain">-&gt;&nbsp;col&nbsp;!=&nbsp;:</span><span class="hl-type">MedV</span><span class="hl-plain">)&nbsp;</span><span class="hl-comment">#&nbsp;MedV&nbsp;平均房价特征</span><br /></div></div><br /><p><strong>tips</strong>
unpack拆包数据集，可以分别用函数指定需要的数据集</p><h3 id='header-0.1 科学类型'>0.1 科学类型<a class='docs-heading-anchor-permalink'></a></h3><h4 id='header-0.1.1 科学类型介绍'>0.1.1 科学类型介绍<a class='docs-heading-anchor-permalink'></a></h4><p><strong>MLJ</strong>扩展出了一系列类型来更好地解释数据集，这种类型叫做<a href='https://alan-turing-institute.github.io/DataScienceTutorials.jl/data/scitype/#type_to_type_coercion' target='_blank'>科学类型</a>
<strong>科学类型</strong>还为模型和指标的<strong>搜索</strong>,<strong>查询</strong>提供了便利
<strong>模型</strong></p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-function">models</span><span class="hl-plain">(</span><span class="hl-function">matching</span><span class="hl-plain">(</span><span class="hl-type">X,y</span><span class="hl-plain">))<br /></span><span class="hl-function">models</span><span class="hl-plain">(</span><span class="hl-function">matching</span><span class="hl-plain">(</span><span class="hl-type">X</span><span class="hl-plain">))<br /></span></div></div><br /><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-repl-code">julia&gt;&nbsp;</span><span class="hl-function">info</span><span class="hl-plain">(</span><span class="hl-string">"RidgeRegressor"</span><span class="hl-plain">,&nbsp;pkg=</span><span class="hl-string">"MLJLinearModels"</span><span class="hl-plain">)<br />...<br /></span><span class="hl-comment">#&nbsp;输入数据的科学类型</span><br /><span class="hl-plain">&nbsp;input_scitype&nbsp;=&nbsp;</span><span class="hl-type">Table{_s23}&nbsp;where&nbsp;_s23</span><span class="hl-plain">&lt;:(</span><span class="hl-type">AbstractArray{_s25,1}&nbsp;where&nbsp;_s25</span><span class="hl-plain">&lt;:</span><span class="hl-type">Continuous</span><span class="hl-plain">),<br />&nbsp;</span><span class="hl-comment">#&nbsp;输出数据的科学类型</span><br /><span class="hl-plain">&nbsp;target_scitype&nbsp;=&nbsp;</span><span class="hl-type">AbstractArray{Continuous,1},</span><span class="hl-plain"><br />...<br /></span></div></div><br /><p><strong>指标</strong></p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-function">measures</span><span class="hl-plain">(</span><span class="hl-function">matching</span><span class="hl-plain">(y))<br /></span></div></div><br /><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-repl-code">julia&gt;&nbsp;</span><span class="hl-function">info</span><span class="hl-plain">(l1)<br />absolute&nbsp;deviations;&nbsp;aliases:&nbsp;</span><span class="hl-string">`l1`</span><span class="hl-plain">.<br />...<br /></span><span class="hl-comment">#&nbsp;虽然也是target，但这个其实是输入的数据类型</span><br /><span class="hl-plain">&nbsp;target_scitype&nbsp;=&nbsp;</span><span class="hl-type">Union{AbstractArray{Continuous,1},&nbsp;AbstractArray{Count,1}},</span><span class="hl-plain"><br />...<br /></span></div></div><br /><h4 id='header-0.1.2 查看科学类型'>0.1.2 查看科学类型<a class='docs-heading-anchor-permalink'></a></h4><p>在数据分析中用到科学类型最多的类型有两种，一种是无限数据<code>Infinite</code>，另一种是有限数据<code>Finite</code>
这里有<a href='https://alan-turing-institute.github.io/MLJScientificTypes.jl/dev/' target='_blank'>更详细的资料</a>
<strong>Infinite</strong></p><ol><li>Continuous
连续数据(其实是小数)</li>
</ol><ol><li>Count
计数数据(其实跟上面的差不多，只不过是整数)
<strong>Finite</strong></li>
</ol><ol><li>OrderdedFactor
有序的分类数据，像是<code>[&quot;bad&quot;, &quot;soso&quot;, &quot;good&quot;]</code>这样，可以比较</li>
</ol><ol><li>Multiclass
无序的分类数据，像是<code>[&quot;Julia&quot;, &quot;Rust&quot;, &quot;Clojure&quot;]</code>这样，没有任何联系</li>
</ol><p>通常对数据集(带有特征字段的命名元组和<code>DataFrame</code>)采用<code>schema</code>
<code> schema(boston)</code></p><table style='float:center'><thead><tr><td>_.names</td><td>_.types</td><td>_.scitypes</td></tr></thead><tbody><tr><td>Crim</td><td>Float64</td><td>Continuous</td></tr><tr><td>Zn</td><td>Float64</td><td>Continuous</td></tr><tr><td>Indus</td><td>Float64</td><td>Continuous</td></tr><tr><td>Chas</td><td>Int64</td><td>Count</td></tr><tr><td>NOx</td><td>Float64</td><td>Continuous</td></tr><tr><td>Rm</td><td>Float64</td><td>Continuous</td></tr><tr><td>Age</td><td>Float64</td><td>Continuous</td></tr><tr><td>Dis</td><td>Float64</td><td>Continuous</td></tr><tr><td>Rad</td><td>Int64</td><td>Count</td></tr><tr><td>Tax</td><td>Int64</td><td>Count</td></tr><tr><td>PTRatio</td><td>Float64</td><td>Continuous</td></tr><tr><td>Black</td><td>Float64</td><td>Continuous</td></tr><tr><td>⋮</td><td>⋮</td><td>⋮</td></tr></tbody></table><p>对没有特征字段的数据可以采用<code>scitype</code>
<code>scitype([1,2,3])</code>
<code>AbstractArray{Count, 1}</code></p><h4 id='header-0.1.3 修改科学类型'>0.1.3 修改科学类型<a class='docs-heading-anchor-permalink'></a></h4><p>修改科学类型用<code>coerce</code>，或可以用原地修改的<code>coerce!</code>
<strong>等等，为什么要修改科学类型？</strong>
分析数据时，区分</p><ol><li>数据如何编码（例如Int），以及</li>
</ol><ol><li>应该如何解释数据（例如，类标签，计数等）</li>
</ol><p>如何被编码的数据将被称为机器类型而数据应如何解释将作为被称为科学型（或scitype）</p><p>但是，在许多其他情况下，可能会有歧义，我们在下面列出一些示例：</p><ol><li>Int向量例如[1, 2, ...]，应将其解释为分类标签，</li>
</ol><ol><li>Int向量例如[1, 2, ...]，应将其解释为计数数据，</li>
</ol><ol><li>String向量[&quot;High&quot;, &quot;Low&quot;, &quot;High&quot;, ...]，应将其解释为有序的分类标签，</li>
</ol><ol><li>String例如的向量[&quot;John&quot;, &quot;Maria&quot;, ...]，应将其解释为无序的多分类数据</li>
</ol><ol><li>浮点向量[1.5, 1.5, -2.3, -2.3]，应将其解释为分类数据（例如，某些设置的几个可能值）等。</li>
</ol><p>为了了解决这种歧异，并更好的对数据集作出解释，我们可以手动修改数据集的科学类型
承接上面的例子</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-type">X&nbsp;</span><span class="hl-plain">=&nbsp;(col_1&nbsp;=&nbsp;[</span><span class="hl-number">1</span><span class="hl-plain">,</span><span class="hl-number">2</span><span class="hl-plain">,</span><span class="hl-number">3</span><span class="hl-plain">],<br />	&nbsp;col_2&nbsp;=&nbsp;[</span><span class="hl-number">1</span><span class="hl-plain">,</span><span class="hl-number">2</span><span class="hl-plain">,</span><span class="hl-number">3</span><span class="hl-plain">],<br />	&nbsp;col_3&nbsp;=&nbsp;[</span><span class="hl-string">"High"</span><span class="hl-plain">,&nbsp;</span><span class="hl-string">"Low"</span><span class="hl-plain">,&nbsp;</span><span class="hl-string">"High"</span><span class="hl-plain">],<br />	&nbsp;col_4&nbsp;=&nbsp;[</span><span class="hl-string">"John"</span><span class="hl-plain">,&nbsp;</span><span class="hl-string">"Maria"</span><span class="hl-plain">,&nbsp;</span><span class="hl-string">"Mike"</span><span class="hl-plain">],<br />	&nbsp;col_5&nbsp;=&nbsp;[</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">5</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">5</span><span class="hl-plain">,&nbsp;-</span><span class="hl-number">2</span><span class="hl-plain">.</span><span class="hl-number">3</span><span class="hl-plain">,&nbsp;-</span><span class="hl-number">2</span><span class="hl-plain">.</span><span class="hl-number">3</span><span class="hl-plain">])<br /></span><span class="hl-function">schema</span><span class="hl-plain">(</span><span class="hl-type">X</span><span class="hl-plain">)	&nbsp;<br /></span></div></div><br /><table style='float:center'><thead><tr><td>_.name</td><td>_.types</td><td>_.scitypes</td></tr></thead><tbody><tr><td>col_1</td><td>Int64</td><td>Count</td></tr><tr><td>col_2</td><td>Int64</td><td>Count</td></tr><tr><td>col_3</td><td>String</td><td>Textual</td></tr><tr><td>col_4</td><td>String</td><td>Textual</td></tr><tr><td>col_5</td><td>Float64</td><td>Continuous</td></tr></tbody></table><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-type">Xhat&nbsp;</span><span class="hl-plain">=&nbsp;</span><span class="hl-function">coerce</span><span class="hl-plain">(</span><span class="hl-type">X,&nbsp;:col_1&nbsp;</span><span class="hl-plain">=&gt;&nbsp;</span><span class="hl-type">OrderedFactor,&nbsp;</span><span class="hl-comment">#&nbsp;这里的分类数据用OrderedFactor来做个例子好了</span><br /><span class="hl-plain">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:col_2&nbsp;=&gt;&nbsp;</span><span class="hl-type">Count,&nbsp;</span><span class="hl-comment">#&nbsp;可有可无</span><br /><span class="hl-plain">		&nbsp;&nbsp;:col_3&nbsp;=&gt;&nbsp;</span><span class="hl-type">OrderedFactor,</span><span class="hl-plain"><br />		&nbsp;&nbsp;:col_4&nbsp;=&gt;&nbsp;</span><span class="hl-type">Multiclass,</span><span class="hl-plain"><br />		&nbsp;&nbsp;:col_5&nbsp;=&gt;&nbsp;</span><span class="hl-type">Multiclass</span><span class="hl-plain">)&nbsp;<br /></span><span class="hl-function">schema</span><span class="hl-plain">(</span><span class="hl-type">Xhat</span><span class="hl-plain">)<br /></span></div></div><br /><table style='float:center'><thead><tr><td>_.names</td><td>_.types</td><td>_.scitypes</td></tr></thead><tbody><tr><td>col_1</td><td>CategoricalValue{Int64,UInt32}</td><td>OrderedFactor{3}</td></tr><tr><td>col_2</td><td>Int64</td><td>Count</td></tr><tr><td>col_3</td><td>CategoricalValue{String,UInt32}</td><td>OrderedFactor{2}</td></tr><tr><td>col_4</td><td>CategoricalValue{String,UInt32}</td><td>Multiclass{3}</td></tr><tr><td>col_5</td><td>CategoricalValue{Float64,UInt32}</td><td>Multiclass{2}</td></tr></tbody></table><p><strong>那么有没有省力的方法帮助我们修改科学类型？</strong>
可以用<code>autotype</code>来指定一些选项，如</p><ol><li>:few_to_finite 如果向量中数据很少，但有很多重复的，转为分类类型<code>Finite</code></li>
</ol><ol><li>:discrete_to_continuous 将离散的<code>Count</code>, <code>Integer</code>转为<code>Continuous</code></li>
</ol><ol><li>:string_to_multiclass 将<code>String</code>变量转为多分类变量
举几个例子
<code>autotype(X, :few_to_finite)</code></li>
</ol><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-type">Dict{Symbol,Type}&nbsp;with&nbsp;5&nbsp;entries:</span><span class="hl-plain"><br />&nbsp;&nbsp;:col_5&nbsp;=&gt;&nbsp;</span><span class="hl-type">OrderedFactor</span><span class="hl-plain"><br />&nbsp;&nbsp;:col_2&nbsp;=&gt;&nbsp;</span><span class="hl-type">OrderedFactor</span><span class="hl-plain"><br />&nbsp;&nbsp;:col_3&nbsp;=&gt;&nbsp;</span><span class="hl-type">Multiclass</span><span class="hl-plain"><br />&nbsp;&nbsp;:col_4&nbsp;=&gt;&nbsp;</span><span class="hl-type">Multiclass</span><span class="hl-plain"><br />&nbsp;&nbsp;:col_1&nbsp;=&gt;&nbsp;</span><span class="hl-type">OrderedFactor</span><span class="hl-plain"><br /></span></div></div><br /><p><code>autotype(X, :discrete_to_continuous)</code></p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-type">Dict{Symbol,Type}&nbsp;with&nbsp;2&nbsp;entries:</span><span class="hl-plain"><br />&nbsp;&nbsp;:col_2&nbsp;=&gt;&nbsp;</span><span class="hl-type">Continuous</span><span class="hl-plain"><br />&nbsp;&nbsp;:col_1&nbsp;=&gt;&nbsp;</span><span class="hl-type">Continuous</span><span class="hl-plain"><br /></span></div></div><br /><p><code>autotype(X, :string_to_multiclass)</code></p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-type">Dict{Symbol,Type}&nbsp;with&nbsp;2&nbsp;entries:</span><span class="hl-plain"><br />&nbsp;&nbsp;:col_3&nbsp;=&gt;&nbsp;</span><span class="hl-type">Multiclass</span><span class="hl-plain"><br />&nbsp;&nbsp;:col_4&nbsp;=&gt;&nbsp;</span><span class="hl-type">Multiclass</span><span class="hl-plain"><br /></span></div></div><br /><p>如果要传入多个参数，把他们包装起来
autotype(X, (:string_to_multiclass, :few_to_finite))</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-type">Dict{Symbol,Type}&nbsp;with&nbsp;5&nbsp;entries:</span><span class="hl-plain"><br />&nbsp;&nbsp;:col_5&nbsp;=&gt;&nbsp;</span><span class="hl-type">OrderedFactor</span><span class="hl-plain"><br />&nbsp;&nbsp;:col_2&nbsp;=&gt;&nbsp;</span><span class="hl-type">OrderedFactor</span><span class="hl-plain"><br />&nbsp;&nbsp;:col_3&nbsp;=&gt;&nbsp;</span><span class="hl-type">Multiclass</span><span class="hl-plain"><br />&nbsp;&nbsp;:col_4&nbsp;=&gt;&nbsp;</span><span class="hl-type">Multiclass</span><span class="hl-plain"><br />&nbsp;&nbsp;:col_1&nbsp;=&gt;&nbsp;</span><span class="hl-type">OrderedFactor</span><span class="hl-plain"><br /></span></div></div><br /><p>最后，只用把返回的字典带入<code>coerce</code>中就可以了</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-function">coerce</span><span class="hl-plain">(</span><span class="hl-type">X,&nbsp;autotype</span><span class="hl-plain">(</span><span class="hl-type">X,&nbsp;:string_to_multiclass</span><span class="hl-plain">))&nbsp;|&gt;&nbsp;schema<br /></span></div></div><br /><table style='float:center'><thead><tr><td>_.names</td><td>_.types</td><td>_.scitypes</td></tr></thead><tbody><tr><td>col_1</td><td>Int64</td><td>Count</td></tr><tr><td>col_2</td><td>Int64</td><td>Count</td></tr><tr><td>col_3</td><td>CategoricalArrays.CategoricalValue{String,UInt32}</td><td>Multiclass{2}</td></tr><tr><td>col_4</td><td>CategoricalArrays.CategoricalValue{String,UInt32}</td><td>Multiclass{3}</td></tr><tr><td>col_5</td><td>Float64</td><td>Continuous</td></tr></tbody></table><p><strong>补充</strong>
对没有特征字段的数据，<code>coerce</code>直接在写类型参数就可以了: <code>coerce([1,2,3], Continuous) # [1.0, 2.0, 3.0]</code></p><h3 id='header-0.2 分类数据'>0.2 分类数据<a class='docs-heading-anchor-permalink'></a></h3><p><code>CategoricalArray</code>是为了完善科学类型中的<code>Finite</code>分类类型，专门设计的分类数据</p><h4 id='header-0.2.1 <code>OrderedFactor</code> 有序的分类数据'>0.2.1 <code>OrderedFactor</code> 有序的分类数据<a class='docs-heading-anchor-permalink'></a></h4><ol><li>转换</li>
</ol><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-repl-code">julia&gt;&nbsp;</span><span class="hl-plain">x1&nbsp;=&nbsp;</span><span class="hl-function">coerce</span><span class="hl-plain">([</span><span class="hl-number">1</span><span class="hl-plain">,</span><span class="hl-number">2</span><span class="hl-plain">,</span><span class="hl-number">3</span><span class="hl-plain">],&nbsp;</span><span class="hl-type">OrderedFactor</span><span class="hl-plain">)<br /></span><span class="hl-number">3</span><span class="hl-plain">-element&nbsp;</span><span class="hl-type">CategoricalArrays</span><span class="hl-plain">.</span><span class="hl-type">CategoricalArray{Int64,1,UInt32}:</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-number">1</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-number">2</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-number">3</span><span class="hl-plain"><br /></span></div></div><br /><ol><li>构造</li>
</ol><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-repl-code">julia&gt;&nbsp;</span><span class="hl-plain">x2&nbsp;=&nbsp;</span><span class="hl-function">categorical</span><span class="hl-plain">([</span><span class="hl-number">1</span><span class="hl-plain">,</span><span class="hl-number">2</span><span class="hl-plain">,</span><span class="hl-number">3</span><span class="hl-plain">],&nbsp;ordered=</span><span class="hl-special">true</span><span class="hl-plain">)<br /></span><span class="hl-number">3</span><span class="hl-plain">-element&nbsp;</span><span class="hl-type">CategoricalArrays</span><span class="hl-plain">.</span><span class="hl-type">CategoricalArray{Int64,1,UInt32}:</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-number">1</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-number">2</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-number">3</span><span class="hl-plain"><br /></span></div></div><br /><ol><li>查看分类顺序</li>
</ol><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-repl-code">julia&gt;&nbsp;</span><span class="hl-function">levels</span><span class="hl-plain">(x1)<br /></span><span class="hl-number">3</span><span class="hl-plain">-element&nbsp;</span><span class="hl-type">Array{Int64,1}:</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-number">1</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-number">2</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-number">3</span><span class="hl-plain"><br /></span></div></div><br /><ol><li>改变分类顺序</li>
</ol><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-repl-code">julia&gt;&nbsp;</span><span class="hl-function">levels!</span><span class="hl-plain">(x1,&nbsp;[</span><span class="hl-number">3</span><span class="hl-plain">,</span><span class="hl-number">2</span><span class="hl-plain">,</span><span class="hl-number">1</span><span class="hl-plain">])<br /></span><span class="hl-number">3</span><span class="hl-plain">-element&nbsp;</span><span class="hl-type">CategoricalArrays</span><span class="hl-plain">.</span><span class="hl-type">CategoricalArray{Int64,1,UInt32}:</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-number">1</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-number">2</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-number">3</span><span class="hl-plain"><br /><br /></span><span class="hl-repl-code">julia&gt;&nbsp;</span><span class="hl-function">levels</span><span class="hl-plain">(x1)<br /></span><span class="hl-number">3</span><span class="hl-plain">-element&nbsp;</span><span class="hl-type">Array{Int64,1}:</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-number">3</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-number">2</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-number">1</span><span class="hl-plain"><br /></span></div></div><br /><h4 id='header-0.2.2 Multiclass 无序的分类数据'>0.2.2 Multiclass 无序的分类数据<a class='docs-heading-anchor-permalink'></a></h4><p>在搜索分类模型的时候，如果你细心点，你会发现一些不同</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-function">info</span><span class="hl-plain">(</span><span class="hl-string">"DecisionTreeClassifier"</span><span class="hl-plain">).prediction_type&nbsp;==&nbsp;:probabilistic&nbsp;</span><span class="hl-comment">#&nbsp;true</span><br /><span class="hl-function">info</span><span class="hl-plain">(</span><span class="hl-string">"SVMClassifier"</span><span class="hl-plain">,&nbsp;pkg=</span><span class="hl-string">"ScikitLearn"</span><span class="hl-plain">).prediction_type&nbsp;==&nbsp;:deterministic&nbsp;</span><span class="hl-comment">#&nbsp;true</span><br /></div></div><br /><p>其中
<code>:probabilistic</code> 指预测时返回的数据是每个分类的概率，如</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-keyword">import</span><span class="hl-plain">&nbsp;</span><span class="hl-type">RDatasets</span><span class="hl-plain"><br />iris&nbsp;=&nbsp;</span><span class="hl-type">RDatasets</span><span class="hl-plain">.</span><span class="hl-function">dataset</span><span class="hl-plain">(</span><span class="hl-string">"datasets"</span><span class="hl-plain">,&nbsp;</span><span class="hl-string">"iris"</span><span class="hl-plain">)<br />y,&nbsp;</span><span class="hl-type">X&nbsp;</span><span class="hl-plain">=&nbsp;</span><span class="hl-function">unpack</span><span class="hl-plain">(iris,&nbsp;==(:</span><span class="hl-type">Species</span><span class="hl-plain">),&nbsp;colname&nbsp;-&gt;&nbsp;</span><span class="hl-special">true</span><span class="hl-plain">)<br /></span><span class="hl-macro">@load</span><span class="hl-plain">&nbsp;</span><span class="hl-type">DecisionTreeClassifier</span><span class="hl-plain"><br />tree_model&nbsp;=&nbsp;</span><span class="hl-type">DecisionTreeClassifier</span><span class="hl-plain">()<br /><br />tree&nbsp;=&nbsp;</span><span class="hl-function">machine</span><span class="hl-plain">(tree_model,&nbsp;</span><span class="hl-type">X,&nbsp;y</span><span class="hl-plain">)<br />train,&nbsp;test&nbsp;=&nbsp;</span><span class="hl-function">partition</span><span class="hl-plain">(</span><span class="hl-function">eachindex</span><span class="hl-plain">(y),&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">7</span><span class="hl-plain">,&nbsp;shuffle&nbsp;=&nbsp;</span><span class="hl-special">true</span><span class="hl-plain">)<br /></span><span class="hl-function">fit!</span><span class="hl-plain">(tree,&nbsp;rows=train)<br />yhat&nbsp;=&nbsp;</span><span class="hl-function">predict</span><span class="hl-plain">(tree,&nbsp;rows=test)<br /></span></div></div><br /><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">&nbsp;</span><span class="hl-type">UnivariateFinite{Multiclass{3}}</span><span class="hl-plain">(setosa=&gt;</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;versicolor=&gt;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;virginica=&gt;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">)<br />&nbsp;</span><span class="hl-type">UnivariateFinite{Multiclass{3}}</span><span class="hl-plain">(setosa=&gt;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;versicolor=&gt;</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;virginica=&gt;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">)<br />&nbsp;</span><span class="hl-type">UnivariateFinite{Multiclass{3}}</span><span class="hl-plain">(setosa=&gt;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;versicolor=&gt;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;virginica=&gt;</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">)<br />...<br /></span></div></div><br /><p>如何获取概率最大的分类呢？？
用<code>mode</code>函数</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">mode.(yhat)<br /></span></div></div><br /><p><strong>tips</strong>
你如果想在预测的时候直接得到分类，就用<code>predict_mode</code></p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">setosa<br />versicolor<br />virginica<br />...<br /></span></div></div><br /><p><code>:deterministic</code> 指预测时i返回的数据是单独的一个类别，如</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-macro">@load</span><span class="hl-plain">&nbsp;</span><span class="hl-type">SVMClassifier&nbsp;pkg</span><span class="hl-plain">=</span><span class="hl-type">ScikitLearn</span><span class="hl-plain"><br />clf&nbsp;=&nbsp;</span><span class="hl-function">fit!</span><span class="hl-plain">(</span><span class="hl-function">machine</span><span class="hl-plain">(</span><span class="hl-type">SVMClassifier</span><span class="hl-plain">(),&nbsp;</span><span class="hl-type">X,&nbsp;y</span><span class="hl-plain">))<br />yhat&nbsp;=&nbsp;</span><span class="hl-function">predict</span><span class="hl-plain">(clf,&nbsp;</span><span class="hl-type">X</span><span class="hl-plain">)<br /></span></div></div><br /><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">&nbsp;</span><span class="hl-string">"setosa"</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-string">"setosa"</span><span class="hl-plain"><br />&nbsp;</span><span class="hl-string">"setosa"</span><span class="hl-plain"><br />...<br /></span></div></div><br /><p>数据太多，就贴三个把:yum:
详细的分类数据文档可以<a href='https://alan-turing-institute.github.io/MLJ.jl/stable/working_with_categorical_data/' target='_blank'>看这里</a></p><p>已有位小伙伴已经翻译好了文档，大家可以看看
https://github.com/noob-data-analaysis/data-analysis/blob/master/%5B%E6%95%B0%E6%8D%AE%E5%8F%98%E6%8D%A2%5D%40AquaIndigo/%E6%95%B0%E6%8D%AE%E5%8F%98%E6%8D%A2.md</p><h2 id='header-1. 数据探索'>1. 数据探索<a class='docs-heading-anchor-permalink'></a></h2><p><img src='/assets/images/data/3.png' alt='image'></p><h3 id='header-1.1 总览 <code>showtable</code>'>1.1 总览 <code>showtable</code><a class='docs-heading-anchor-permalink'></a></h3><p><code>showtable(X) # 这个大家在jupyter notebook里试一下就好了，我这里不能导出markdown， 我让别人帮我试了一下也有问题，那就是作者的问题了</code></p><h3 id='header-1.2 查看每列的科学类型 <code>schema</code>'>1.2 查看每列的科学类型 <code>schema</code><a class='docs-heading-anchor-permalink'></a></h3><p><code> schema(boston)</code></p><table style='float:center'><thead><tr><td>_.names</td><td>_.types</td><td>_.scitypes</td></tr></thead><tbody><tr><td>Crim</td><td>Float64</td><td>Continuous</td></tr><tr><td>Zn</td><td>Float64</td><td>Continuous</td></tr><tr><td>Indus</td><td>Float64</td><td>Continuous</td></tr><tr><td>Chas</td><td>Int64</td><td>Count</td></tr><tr><td>NOx</td><td>Float64</td><td>Continuous</td></tr><tr><td>Rm</td><td>Float64</td><td>Continuous</td></tr><tr><td>Age</td><td>Float64</td><td>Continuous</td></tr><tr><td>Dis</td><td>Float64</td><td>Continuous</td></tr><tr><td>Rad</td><td>Int64</td><td>Count</td></tr><tr><td>Tax</td><td>Int64</td><td>Count</td></tr><tr><td>PTRatio</td><td>Float64</td><td>Continuous</td></tr><tr><td>Black</td><td>Float64</td><td>Continuous</td></tr><tr><td>⋮</td><td>⋮</td><td>⋮</td></tr></tbody></table><p><strong>注意</strong></p><h3 id='header-1.3 自定义查看内容 <code>describe</code>'>1.3 自定义查看内容 <code>describe</code><a class='docs-heading-anchor-permalink'></a></h3><p>需要注意的是，<code>describe</code>不能对命名元组起作用，需要<code>DataFrame</code>类型，这个函数是专门为<code>DataFrame</code>设计的</p><h4 id='header-1.3.1 内置功能'>1.3.1 内置功能<a class='docs-heading-anchor-permalink'></a></h4><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-function">describe</span><span class="hl-plain">(</span><span class="hl-type">X,&nbsp;:nmissing</span><span class="hl-plain">)&nbsp;</span><span class="hl-comment">#&nbsp;每一列有missing的数量</span><br /><span class="hl-number">13</span><span class="hl-plain">×</span><span class="hl-number">2</span><span class="hl-plain">&nbsp;</span><span class="hl-type">DataFrame</span><span class="hl-plain"><br /></span></div></div><br /><table style='float:center'><thead><tr><td>Row</td><td>variable</td><td>nmissing</td></tr></thead><tbody><tr><td></td><td>Symbol</td><td>Nothing</td></tr><tr><td>1</td><td>Crim</td><td></td></tr><tr><td>2</td><td>Zn</td><td></td></tr><tr><td>3</td><td>Indus</td><td></td></tr><tr><td>4</td><td>Chas</td><td></td></tr><tr><td>5</td><td>NOx</td><td></td></tr><tr><td>6</td><td>Rm</td><td></td></tr><tr><td>7</td><td>Age</td><td></td></tr><tr><td>8</td><td>Dis</td><td></td></tr><tr><td>9</td><td>Rad</td><td></td></tr></tbody></table><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-function">describe</span><span class="hl-plain">(</span><span class="hl-type">X,&nbsp;:min,&nbsp;:max,&nbsp;:mean,&nbsp;:std</span><span class="hl-plain">)&nbsp;</span><span class="hl-comment">#&nbsp;每一列的最小值，最大值，平均值，标准差，他们会跳过missing</span><br /></div></div><br /><table style='float:center'><thead><tr><td>Row</td><td>variable</td><td>min</td><td>max</td><td>mean</td><td>std</td></tr></thead><tbody><tr><td></td><td>Symbol</td><td>Real</td><td>Real</td><td>Float64</td><td>Float64</td></tr><tr><td>1</td><td>Crim</td><td>0.00632</td><td>88.9762</td><td>3.61352</td><td>8.60155</td></tr><tr><td>2</td><td>Zn</td><td>0.0</td><td>100.0</td><td>11.3636</td><td>23.3225</td></tr><tr><td>3</td><td>Indus</td><td>0.46</td><td>27.74</td><td>11.1368</td><td>6.86035</td></tr><tr><td>4</td><td>Chas</td><td>0</td><td>1</td><td>0.06917</td><td>0.253994</td></tr><tr><td>5</td><td>NOx</td><td>0.385</td><td>0.871</td><td>0.554695</td><td>0.115878</td></tr><tr><td>6</td><td>Rm</td><td>3.561</td><td>8.78</td><td>6.28463</td><td>0.702617</td></tr><tr><td>7</td><td>Age</td><td>2.9</td><td>100.0</td><td>68.5749</td><td>28.1489</td></tr><tr><td>8</td><td>Dis</td><td>1.1296</td><td>12.1265</td><td>3.79504</td><td>2.10571</td></tr><tr><td>9</td><td>Rad</td><td>1</td><td>24</td><td>9.54941</td><td>8.70726</td></tr><tr><td>10</td><td>Tax</td><td>187</td><td>711</td><td>408.237</td><td>168.537</td></tr><tr><td>11</td><td>PTRatio</td><td>12.6</td><td>22.0</td><td>18.4555</td><td>2.16495</td></tr><tr><td>12</td><td>Black</td><td>0.32</td><td>396.9</td><td>356.674</td><td>91.2949</td></tr><tr><td>13</td><td>LStat</td><td>1.73</td><td>37.97</td><td>12.6531</td><td>7.14106</td></tr></tbody></table><h4 id='header-1.3.2 自定义功能'>1.3.2 自定义功能<a class='docs-heading-anchor-permalink'></a></h4><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-function">desribe</span><span class="hl-plain">(</span><span class="hl-type">X,&nbsp;:symbol&nbsp;</span><span class="hl-plain">=&gt;&nbsp;fn)&nbsp;</span><span class="hl-comment">#&nbsp;fn作用于整个列</span><br /></div></div><br /><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-function">desribe</span><span class="hl-plain">(</span><span class="hl-type">X,&nbsp;:symbol&nbsp;</span><span class="hl-plain">=&gt;&nbsp;sum)&nbsp;<br /></span></div></div><br /><table style='float:center'><thead><tr><td>Row</td><td>variable</td><td>symbol</td></tr></thead><tbody><tr><td></td><td>Symbol</td><td>Real</td></tr><tr><td>1</td><td>Crim</td><td>1828.44</td></tr><tr><td>2</td><td>Zn</td><td>5750.0</td></tr><tr><td>3</td><td>Indus</td><td>5635.21</td></tr><tr><td>4</td><td>Chas</td><td>35</td></tr><tr><td>5</td><td>NOx</td><td>280.676</td></tr><tr><td>6</td><td>Rm</td><td>3180.02</td></tr><tr><td>7</td><td>Age</td><td>34698.9</td></tr><tr><td>8</td><td>Dis</td><td>1920.29</td></tr><tr><td>9</td><td>Rad</td><td>4832</td></tr><tr><td>10</td><td>Tax</td><td>206568</td></tr><tr><td>11</td><td>PTRatio</td><td>9338.5</td></tr><tr><td>12</td><td>Black</td><td>180477.0</td></tr><tr><td>13</td><td>LStat</td><td>6402.45</td></tr></tbody></table><h2 id='header-2. 数据清洗'>2. 数据清洗<a class='docs-heading-anchor-permalink'></a></h2><p><img src='/assets/images/data/4.png' alt='image'></p><h3 id='header-2.1 特征选择 <code>FeatureSelector</code>'>2.1 特征选择 <code>FeatureSelector</code><a class='docs-heading-anchor-permalink'></a></h3><p><strong>文档</strong>
<code>FeatureSelector(features=Symbol[])</code>
<strong>注意</strong>
这个<code>model</code>用来选择<code>DataFrame</code>或<code>NamedTuple</code>的特征字段
<strong>示例</strong></p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">model&nbsp;=&nbsp;</span><span class="hl-type">FeatureSelector</span><span class="hl-plain">([:</span><span class="hl-type">Crim</span><span class="hl-plain">])&nbsp;</span><span class="hl-comment">#&nbsp;选择Crim的特征字段</span><br /><span class="hl-plain">mach&nbsp;=&nbsp;</span><span class="hl-function">fit!</span><span class="hl-plain">(</span><span class="hl-function">machine</span><span class="hl-plain">(model,&nbsp;</span><span class="hl-type">X</span><span class="hl-plain">))<br /></span><span class="hl-type">MLJ</span><span class="hl-plain">.</span><span class="hl-function">transform</span><span class="hl-plain">(mach,&nbsp;</span><span class="hl-type">X</span><span class="hl-plain">)&nbsp;|&gt;&nbsp;df&nbsp;-&gt;&nbsp;</span><span class="hl-function">first</span><span class="hl-plain">(df,&nbsp;</span><span class="hl-number">5</span><span class="hl-plain">)&nbsp;</span><span class="hl-comment">#&nbsp;这里的transform会与DataFrame的transform冲突，要指定模块为MLJ</span><br /></div></div><br /><p>表格太难打了，我这里就给出5个数据好了</p><table style='float:center'><thead><tr><td>Row</td><td>Crim</td></tr></thead><tbody><tr><td></td><td>Float64</td></tr><tr><td>1</td><td>0.00632</td></tr><tr><td>2</td><td>0.02731</td></tr><tr><td>3</td><td>0.02729</td></tr><tr><td>4</td><td>0.03237</td></tr><tr><td>5</td><td>0.06905</td></tr></tbody></table><h3 id='header-2.2 清洗缺失值 <code>FillImputer</code>'>2.2 清洗缺失值 <code>FillImputer</code><a class='docs-heading-anchor-permalink'></a></h3><p><strong>文档</strong></p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-type">FillImputer</span><span class="hl-plain">(<br />&nbsp;&nbsp;&nbsp;features&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[],<br />&nbsp;&nbsp;&nbsp;continuous_fill&nbsp;=&nbsp;e&nbsp;-&gt;&nbsp;</span><span class="hl-function">skipmissing</span><span class="hl-plain">(e)&nbsp;|&gt;&nbsp;median<br />&nbsp;&nbsp;&nbsp;count_fill&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;e&nbsp;-&gt;&nbsp;</span><span class="hl-function">skipmissing</span><span class="hl-plain">(e)&nbsp;|&gt;&nbsp;(f&nbsp;-&gt;&nbsp;</span><span class="hl-function">round</span><span class="hl-plain">(</span><span class="hl-function">eltype</span><span class="hl-plain">(f),&nbsp;</span><span class="hl-function">median</span><span class="hl-plain">(f)))<br />&nbsp;&nbsp;&nbsp;finite_fill&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;e&nbsp;-&gt;&nbsp;</span><span class="hl-function">skipmissing</span><span class="hl-plain">(e)&nbsp;|&gt;&nbsp;mode)<br /></span></div></div><br /><p><strong>注意</strong>
<code>FillImputer</code>可以指定特征列来填充<code>missing</code>值，默认的填充函数以给出，也可以自己定义</p><blockquote><p>•    continuous_fill: function to use on Continuous data, by
default the median
•    count_fill: function to use on Count data, by default the
rounded median
•    finite_fill: function to use on Multiclass and OrderedFactor
data (including binary data), by default the mode</p></blockquote><p><strong>示例</strong></p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">df&nbsp;=&nbsp;</span><span class="hl-function">coerce</span><span class="hl-plain">((x1&nbsp;=&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">:</span><span class="hl-number">3</span><span class="hl-plain">,&nbsp;x2&nbsp;=&nbsp;[</span><span class="hl-special">missing</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">2</span><span class="hl-plain">]),&nbsp;:x2&nbsp;=&gt;&nbsp;</span><span class="hl-type">Continuous</span><span class="hl-plain">)<br /></span><span class="hl-function">schema</span><span class="hl-plain">(df)<br /></span></div></div><br /><table style='float:center'><thead><tr><td>_.name</td><td>_.types</td><td>_.scitype</td></tr></thead><tbody><tr><td>x1</td><td>Int64</td><td>Count</td></tr><tr><td>x2</td><td>Union{Missing, Float64}</td><td>Union{Missing, Continuous}</td></tr></tbody></table><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">model&nbsp;=&nbsp;</span><span class="hl-type">FillImputer</span><span class="hl-plain">(continuous_fill&nbsp;=&nbsp;e&nbsp;-&gt;&nbsp;</span><span class="hl-function">skipmissing</span><span class="hl-plain">(e)&nbsp;|&gt;&nbsp;mean)<br />mach&nbsp;=&nbsp;</span><span class="hl-function">fit!</span><span class="hl-plain">(</span><span class="hl-function">machine</span><span class="hl-plain">(model,&nbsp;df))<br />w&nbsp;=&nbsp;</span><span class="hl-type">MLJ</span><span class="hl-plain">.</span><span class="hl-function">transform</span><span class="hl-plain">(mach,&nbsp;df)	<br /></span><span class="hl-function">schema</span><span class="hl-plain">(w)<br /></span></div></div><br /><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-repl-code">julia&gt;&nbsp;</span><span class="hl-plain">w&nbsp;=&nbsp;</span><span class="hl-type">MLJ</span><span class="hl-plain">.</span><span class="hl-function">transform</span><span class="hl-plain">(mach,&nbsp;df)<br />(x1&nbsp;=&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">:</span><span class="hl-number">3</span><span class="hl-plain">,<br />&nbsp;x2&nbsp;=&nbsp;[</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">5</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">2</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">],)<br /></span></div></div><br /><table style='float:center'><thead><tr><td>_.name</td><td>_.types</td><td>_.scitype</td></tr></thead><tbody><tr><td>x1</td><td>Int64</td><td>Count</td></tr><tr><td>x2</td><td>Union{Missing, Float64}</td><td>Continuous</td></tr></tbody></table><h2 id='header-3. 数据转换'>3. 数据转换<a class='docs-heading-anchor-permalink'></a></h2><p><img src='/assets/images/data/5.png' alt='image'></p><h3 id='header-3.1 数据标准化 <code>Standardizer</code>'>3.1 数据标准化 <code>Standardizer</code><a class='docs-heading-anchor-permalink'></a></h3><p><strong>文档</strong>
<code>  Standardizer(; features=Symbol[], ignore=false, ordered_factor=false, count=false)</code>
$$
newX = \frac{X' - mean(X)} {Std(X)}
$$</p><p><strong>注意</strong>
其中</p><ul><li>X'   需要转换的数组</li>
</ul><ul><li>X    用来拟合的原数据</li>
</ul><ul><li>newX 转换X' 后的新数组</li>
</ul><p>另外
<code>Standardizer</code>只对<code>Continuous</code>科学类型的数据有效，如果在数据集中有科学类型为<code>OrderedFactor</code>或<code>Count</code>的<code>nums</code>，可以在<code>Standardizer</code>中指定<code>ordered_factor=true</code>或<code>count=true</code></p><p><strong>示例</strong></p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-type">X&nbsp;</span><span class="hl-plain">=&nbsp;(ordinal1&nbsp;=&nbsp;[</span><span class="hl-number">1</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">2</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">3</span><span class="hl-plain">],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ordinal2&nbsp;=&nbsp;</span><span class="hl-function">categorical</span><span class="hl-plain">([:x,&nbsp;:y,&nbsp;:x],&nbsp;ordered=</span><span class="hl-special">true</span><span class="hl-plain">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ordinal3&nbsp;=&nbsp;[</span><span class="hl-number">10</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">20</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">30</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ordinal4&nbsp;=&nbsp;[-</span><span class="hl-number">20</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;-</span><span class="hl-number">30</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;-</span><span class="hl-number">40</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nominal&nbsp;=&nbsp;</span><span class="hl-function">categorical</span><span class="hl-plain">([</span><span class="hl-string">"Your&nbsp;father"</span><span class="hl-plain">,&nbsp;</span><span class="hl-string">"he"</span><span class="hl-plain">,&nbsp;</span><span class="hl-string">"is"</span><span class="hl-plain">]));<br /><br /></span><span class="hl-function">schema</span><span class="hl-plain">(</span><span class="hl-type">X</span><span class="hl-plain">)<br /></span></div></div><br /><table style='float:center'><thead><tr><td>_.names</td><td>_.types</td><td>_.scitypes</td></tr></thead><tbody><tr><td>ordinal1</td><td>Int64</td><td>Count</td></tr><tr><td>ordinal2</td><td>CategoricalArrays.CategoricalValue{Symbol,UInt32}</td><td>OrderedFactor{2}</td></tr><tr><td>ordinal3</td><td>Float64</td><td>Continuous</td></tr><tr><td>ordinal4</td><td>Float64</td><td>Continuous</td></tr><tr><td>nominal</td><td>CategoricalArrays.CategoricalValue{String,UInt32}</td><td>Multiclass{3}</td></tr></tbody></table><p>尝试先不把<code>ordinal1</code>转换</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">model&nbsp;=&nbsp;</span><span class="hl-type">Standardizer</span><span class="hl-plain">()<br />mach&nbsp;=&nbsp;</span><span class="hl-function">fit!</span><span class="hl-plain">(</span><span class="hl-function">machine</span><span class="hl-plain">(model,&nbsp;</span><span class="hl-type">X</span><span class="hl-plain">))<br /></span><span class="hl-function">transform</span><span class="hl-plain">(mach,&nbsp;</span><span class="hl-type">X</span><span class="hl-plain">)<br /></span></div></div><br /><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">(ordinal1&nbsp;=&nbsp;[</span><span class="hl-number">1</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">2</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">3</span><span class="hl-plain">],<br />&nbsp;ordinal2&nbsp;=&nbsp;</span><span class="hl-type">CategoricalArrays</span><span class="hl-plain">.</span><span class="hl-type">CategoricalValue{Symbol,UInt32}</span><span class="hl-plain">[:x,&nbsp;:y,&nbsp;:x],<br />&nbsp;ordinal3&nbsp;=&nbsp;[-</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">],<br />&nbsp;ordinal4&nbsp;=&nbsp;[</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;-</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">],<br />&nbsp;nominal&nbsp;=&nbsp;</span><span class="hl-type">CategoricalArrays</span><span class="hl-plain">.</span><span class="hl-type">CategoricalValue{String,UInt32}</span><span class="hl-plain">[</span><span class="hl-string">"Your&nbsp;father"</span><span class="hl-plain">,&nbsp;</span><span class="hl-string">"he"</span><span class="hl-plain">,&nbsp;</span><span class="hl-string">"is"</span><span class="hl-plain">],)<br /></span></div></div><br /><p>下面我们将<code>Count</code>和<code>OrderedFactor</code>转换
不过这里需要对<code>ordered_factor=true</code>另外说明
不管这个<code>nums</code>的内容是什么类型，<code>Standardizer</code>都能帮他转换。
不过在此之前先会把<code>nums</code>转化为数字数组</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-comment">#&nbsp;先将X的ordinal2提取出来</span><br /><span class="hl-plain">temp&nbsp;=&nbsp;</span><span class="hl-type">X</span><span class="hl-plain">.ordered2<br />nums&nbsp;=&nbsp;</span><span class="hl-function">coerce</span><span class="hl-plain">(temp,&nbsp;</span><span class="hl-type">Count</span><span class="hl-plain">)<br /></span><span class="hl-comment">#&nbsp;3-element&nbsp;Array{Int64,1}:</span><br /><span class="hl-comment">#&nbsp;&nbsp;1</span><br /><span class="hl-comment">#&nbsp;&nbsp;2</span><br /><span class="hl-comment">#&nbsp;&nbsp;1</span><br /><span class="hl-plain"><br />model&nbsp;=&nbsp;</span><span class="hl-type">UnivariateStandardizer</span><span class="hl-plain">()&nbsp;</span><span class="hl-comment">#&nbsp;UnivariateStandardizer&nbsp;和&nbsp;Standardizer&nbsp;类似,&nbsp;UnivariateStandardizer不能用在命名元组DataFrame上，另外UnivariateStandardizer没有参数，不会忽略Count类型</span><br /><span class="hl-plain">mach&nbsp;=&nbsp;</span><span class="hl-function">fit!</span><span class="hl-plain">(</span><span class="hl-function">machine</span><span class="hl-plain">(model,&nbsp;nums)<br /></span><span class="hl-function">transform</span><span class="hl-plain">(mach,&nbsp;nums)</span><span class="hl-string">``</span><span class="hl-string">`<br /><br />`</span><span class="hl-string">``</span><span class="hl-plain">julia<br />&nbsp;-</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">5773502691896256</span><span class="hl-plain"><br />&nbsp;&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">1547005383792517</span><span class="hl-plain"><br />&nbsp;-</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">5773502691896256</span><span class="hl-plain"><br /></span></div></div><br /><p>验证一下我们的想法</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">model&nbsp;=&nbsp;</span><span class="hl-type">Standardizer</span><span class="hl-plain">(ordered_factor&nbsp;=&nbsp;</span><span class="hl-special">true</span><span class="hl-plain">)<br />mach&nbsp;=&nbsp;</span><span class="hl-function">fit!</span><span class="hl-plain">(</span><span class="hl-function">machine</span><span class="hl-plain">(model,&nbsp;</span><span class="hl-type">X</span><span class="hl-plain">))<br /></span><span class="hl-function">transform</span><span class="hl-plain">(mach,&nbsp;</span><span class="hl-type">X</span><span class="hl-plain">)<br /></span></div></div><br /><p>可以看到<code>ordered2</code>那里一毛一样</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">(ordinal1&nbsp;=&nbsp;[-</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">],<br />&nbsp;ordinal2&nbsp;=&nbsp;[-</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">5773502691896256</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">1547005383792517</span><span class="hl-plain">,&nbsp;-</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">5773502691896256</span><span class="hl-plain">],<br />&nbsp;ordinal3&nbsp;=&nbsp;[-</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">],<br />&nbsp;ordinal4&nbsp;=&nbsp;[</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">0</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">,&nbsp;-</span><span class="hl-number">1</span><span class="hl-plain">.</span><span class="hl-number">0</span><span class="hl-plain">],<br />&nbsp;nominal&nbsp;=&nbsp;</span><span class="hl-type">CategoricalArrays</span><span class="hl-plain">.</span><span class="hl-type">CategoricalValue{String,UInt32}</span><span class="hl-plain">[</span><span class="hl-string">"Your&nbsp;father"</span><span class="hl-plain">,&nbsp;</span><span class="hl-string">"he"</span><span class="hl-plain">,&nbsp;</span><span class="hl-string">"is"</span><span class="hl-plain">],)<br /></span></div></div><br /><h3 id='header-3.2 数据归一化'>3.2 数据归一化<a class='docs-heading-anchor-permalink'></a></h3><p>文档里没有找到，可能要自定义模型了</p><h3 id='header-3.3 数据离散化'>3.3 数据离散化<a class='docs-heading-anchor-permalink'></a></h3><ol><li>连续变量
本来连续变量的离散化分为等宽，等频，聚类等，但是在文档里只找到了等宽离散化的<code>UnivariateDiretizer</code>
<strong>文档</strong></li>
</ol><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">&nbsp;&nbsp;</span><span class="hl-type">UnivariateDiscretizer</span><span class="hl-plain">(n_classes=</span><span class="hl-number">512</span><span class="hl-plain">)<br /><br />&nbsp;&nbsp;</span><span class="hl-type">Returns&nbsp;an&nbsp;MLJModel&nbsp;for&nbsp;for&nbsp;discretizing&nbsp;any&nbsp;continuous&nbsp;vector&nbsp;v</span><span class="hl-plain"><br />&nbsp;&nbsp;(</span><span class="hl-function">scitype</span><span class="hl-plain">(v)&nbsp;&lt;:&nbsp;</span><span class="hl-type">AbstractVector{Continuous}</span><span class="hl-plain">),&nbsp;</span><span class="hl-keyword">where</span><span class="hl-plain">&nbsp;n_classes&nbsp;describes<br />&nbsp;&nbsp;the&nbsp;resolution&nbsp;of&nbsp;the&nbsp;discretization.<br /></span></div></div><br /><p><strong>注意</strong>
等宽离散化，<code>n_classes</code>代表你想分多少个类
返回值为分类数组<code>OrderedFactor</code>
<strong>示例</strong>
这里我们对一个<code>1 ~ 100</code>的数组进行等宽离散化，我们把类别设置为10，转换一些随机数</p><div class='language language-julia'><div class='codeblock-header'></div><div class='codeblock-body'><span class="hl-plain">data&nbsp;=&nbsp;</span><span class="hl-function">coerce</span><span class="hl-plain">(</span><span class="hl-number">1</span><span class="hl-plain">:</span><span class="hl-number">100</span><span class="hl-plain">,&nbsp;</span><span class="hl-type">Continuous</span><span class="hl-plain">)<br />t&nbsp;=&nbsp;</span><span class="hl-type">UnivariateDiscretizer</span><span class="hl-plain">(n_classes&nbsp;=&nbsp;</span><span class="hl-number">10</span><span class="hl-plain">)<br />discretizer&nbsp;=&nbsp;</span><span class="hl-function">fit!</span><span class="hl-plain">(</span><span class="hl-function">machine</span><span class="hl-plain">(t,&nbsp;data))<br />v&nbsp;=&nbsp;</span><span class="hl-function">rand</span><span class="hl-plain">(</span><span class="hl-number">1</span><span class="hl-plain">:</span><span class="hl-number">100</span><span class="hl-plain">,&nbsp;</span><span class="hl-number">10</span><span class="hl-plain">)<br />w&nbsp;=&nbsp;</span><span class="hl-function">transform</span><span class="hl-plain">(discretizer,&nbsp;v)<br /></span></div></div><br /><table style='float:center'><thead><tr><td>随机数 v</td><td>分类顺序</td></tr></thead><tbody><tr><td>11</td><td>2</td></tr><tr><td>54</td><td>6</td></tr><tr><td>19</td><td>2</td></tr><tr><td>92</td><td>10</td></tr><tr><td>43</td><td>5</td></tr><tr><td>53</td><td>6</td></tr><tr><td>87</td><td>9</td></tr><tr><td>23</td><td>3</td></tr><tr><td>39</td><td>4</td></tr><tr><td>91</td><td>10</td></tr></tbody></table><p><strong>tips</strong>
用<code>convert(Vector{Int}, w)</code>获得分类数据的排序情况</p><ol><li>分类变量
<ol>
<li>
<p>有序变量 <code>OrderedFactor</code>
在文档里没有这个模型，不过作者告诉我可以用<code>coerce</code>强制转换科学类型
如果按原有的分类顺序来转换</p>
<pre><code class="language-julia">nums = categorical([:x, :y:, :z], ordered=true)
levels(nums) # 1, 2, 3
coerce(nums, Count) # 1,2,3
coerce(nums, Continuous) # 1.0 2.0 3.0
</code></pre>
<p>也可以改变分类顺序</p>
<pre><code class="language-julia">levels!(nums, [:z, :y, :z])
coerce(nums, Count) # 3, 2, 1
</code></pre>
</li>
<li>
<p>无序变量 <code>Multiclass</code>
<strong>文档</strong>
有两个模型可以做这个，<code>OneHotEncoder</code>和<code>ContinuousEncoder</code></p>
<pre><code class="language-julia">  OneHotEncoder(; features=Symbol[],
            ignore=false,
            ordered_factor=true,
            drop_last=false)
</code></pre>
<pre><code class="language-julia">  ContinuousEncoder(one_hot_ordered_factors=false, drop_last=false)
</code></pre>
<p><strong>注意</strong>
两个模型作用一样，在转换的过程中保留<code>Infinite</code>数据，转换<code>Multiclass</code>数据，不过<code>ContinuousEncoder</code>会丢弃无关的数据，如<code>Textual</code>数据，<code>OneHotEncoder</code>会保留所有特征字段</p>
<p>额，他们怎么转换我说不清，看代码把:yum:
<strong>示例</strong></p>
<ol>
<li><code>OneHotEncoder</code></li>
</ol>
<pre><code class="language-julia">data = (col = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;],)
nums = coerce(data, :col =&gt; Multiclass{3})
model = OneHotEncoder()
mach = fit!(machine(model, nums))
transform(mach, nums)
</code></pre>
<pre><code class="language-julia">(col__a = [1.0, 0.0, 0.0],
col__b = [0.0, 1.0, 0.0],
col__c = [0.0, 0.0, 1.0],)
</code></pre>
<ol start="2">
<li><code>ContinuousEncoder</code></li>
</ol>
<pre><code class="language-julia">data = (col = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;],
vals = [1, 2, 3])
schema(data)
</code></pre>
<table><thead><tr><th align="center">_.names</th><th align="center">_.types</th><th align="center">_.scitypes</th></tr></thead><tbody><tr><td align="center">col</td><td align="center">String</td><td align="center">Textual</td></tr><tr><td align="center">vals</td><td align="center">Int64</td><td align="center">Count</td></tr></tbody></table>
<pre><code class="language-julia">model = ContinuousEncoder()
mach  = fit!(machine(model, data))
transform(mach, data)
</code></pre>
<pre><code class="language-julia">(vals = [1.0, 2.0, 3.0],)
</code></pre>
</li>
</ol>
</li>
</ol><p>详细文档<a href='https://alan-turing-institute.github.io/MLJ.jl/stable/transformers/' target='_blank'>在这里</a></p></article>
			<nav class="docs-footer"></nav>
			<div class='giscus'></div>
		</div>
		<div class="modal" id="documenter-settings">
			<div class="modal-background"></div>
			<div class="modal-card">
				<header class="modal-card-head">
					<p class="modal-card-title">设置</p>
					<button class="delete"></button>
				</header>
				<section class="modal-card-body">
					<p><label class="label">选择主题</label>
						<div class="select">
							<select id="documenter-themepicker">
								<option value="light">light</option><option value="dark">dark</option>
							</select>
						</div>
					</p>
				</section>
				<footer class="modal-card-foot"></footer>
			</div>
		</div>
	</div>
</body>
</html>
